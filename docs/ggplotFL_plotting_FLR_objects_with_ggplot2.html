<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>ggplotFL: plotting FLR objects with ggplot2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
    <li>
      <a href="Using_information_on_life_history_relationships.html">Using information on Life History relationships</a>
    </li>
    <li>
      <a href="Life_history_relationships.html">Life history relationships</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="Management_procedure_biomass_dynamic.html">Biomass Dynamic Management Procedures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    FLBEIA
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="Conditioning_FLBEIA.html">Conditioning FLBEIA using Smart Conditioning Functions</a>
    </li>
    <li>
      <a href="FLBEIA_A_Simple_Example.html">A simple example on how to use FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_An_Example_with_multiple_dimensions.html">A simple example with multiple dimensions in FLBEIA</a>
    </li>
    <li>
      <a href="Using_Assessment_models_in_the_MP_FLBEIA.html">Using Stock Assessment models in the Management procedure of FLBEIA</a>
    </li>
    <li>
      <a href="Testing_Management_Strategies_in_FLBEIA.html">Testing different Management Strategies in FLBEIA</a>
    </li>
    <li>
      <a href="Data_Poor_MSE_in_FLBEIA.html">Data Limited MSE in FLBEIA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">ggplotFL: plotting FLR objects with ggplot2</h1>
<h4 class="date"><em>03 March, 2019</em></h4>

</div>


<p>The R package <code>ggplot2</code> offers a plotting style and tools that are increasingly becoming a data visualization standard. One of the added values of <code>ggplot2</code> is the ease in displaying highly dimensional data in an intuitive way. For these reasons there are a number of standard methods implemented in the package <code>ggplotFL</code> to plot FLR objects, stock assessment diagnostics and MSE results. In addition, standard <code>ggplot2</code> methods and functions can be used by converting FLR objects into data frames, thus giving an extra flexibility in plotting.</p>
<div id="required-packages" class="section level1">
<h1>Required packages</h1>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/ggplot2/index.html">ggplot2</a></li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a></li>
</ul>
<p>You can do so as follows,</p>
<pre class="r"><code>install.packages(&quot;ggplot2&quot;)
install.packages(c(&quot;ggplotFL&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
<pre class="r"><code># Load all necessary packages, trim pkg messages
library(FLCore)
library(ggplotFL)

# Load datasets for tutorial
data(&quot;ple4&quot;)
data(&quot;ple4sex&quot;)
data(&quot;nsher&quot;)</code></pre>
</div>
<div id="using-ggplot2-with-flr-objects" class="section level1">
<h1>Using <code>ggplot2</code> with <em>FLR</em> objects</h1>
<p>The <code>ggplot2</code> package provides a powerful alternative paradigm for creating both simple and complex plots in R using the ideas of Wilkinson’s <em>Grammar of Graphics</em>.</p>
<p>To facilitate the use of <code>ggplot2</code> methods in <em>FLR</em>, the <code>ggplotFL</code> package has been created. The main resources on offer in this package are overloaded versions of the <code>ggplot()</code> method that directly accept certain <em>FLR</em> classes, a new set of basic plots for some <em>FLR</em> classes based on <code>ggplot2</code> instead of <code>lattice</code>, and some examples and documentation on how best to make use of <code>ggplot2</code>’s powerful paradigm and implementation to obtain high quality plots for even fairly complex data structures.</p>
<div id="the-overloaded-ggplot-method" class="section level2">
<h2>The overloaded <code>ggplot</code> method</h2>
<p>The standard <code>ggplot</code> function expects a <code>data.frame</code> for its first argument, <em>data</em>. If <code>ggplot</code> is called with an <em>FLR</em> object, a conversion to <code>data.frame</code> takes place, and any other arguments provided get passed to the original <code>ggplot()</code>. The conversion makes use of <code>as.data.frame</code><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> methods defined in <code>FLCore</code>, with the <em>cohort</em> argument set to <em>TRUE</em>.</p>
<p>As an example, the <code>FLStock</code> of <code>ple4</code> is a list containing a number of elements.</p>
<pre class="r"><code># summary of the FLStock
summary(ple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name: PLE 
Description: Plaice in IV. ICES WGNSSK 2018. FLAAP 
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  61  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2017    2   6   

catch         : [ 1 61 1 1 1 1 ], units =  t 
catch.n       : [ 10 61 1 1 1 1 ], units =  1000 
catch.wt      : [ 10 61 1 1 1 1 ], units =  kg 
discards      : [ 1 61 1 1 1 1 ], units =  t 
discards.n    : [ 10 61 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 61 1 1 1 1 ], units =  kg 
landings      : [ 1 61 1 1 1 1 ], units =  t 
landings.n    : [ 10 61 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 61 1 1 1 1 ], units =  kg 
stock         : [ 1 61 1 1 1 1 ], units =  t 
stock.n       : [ 10 61 1 1 1 1 ], units =  1000 
stock.wt      : [ 10 61 1 1 1 1 ], units =  kg 
m             : [ 10 61 1 1 1 1 ], units =  m 
mat           : [ 10 61 1 1 1 1 ], units =   
harvest       : [ 10 61 1 1 1 1 ], units =  f 
harvest.spwn  : [ 10 61 1 1 1 1 ], units =   
m.spwn        : [ 10 61 1 1 1 1 ], units =   </code></pre>
<p>By calling <code>as.data.frame()</code> on an <code>FLStock</code>, the list is collapsed to a dataframe that than can be plotted by selecting the right dimensions in terms of slot, age, iter, etc.. :</p>
<pre class="r"><code>head(as.data.frame(ple4))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">slot</th>
<th align="left">age</th>
<th align="right">year</th>
<th align="left">unit</th>
<th align="left">season</th>
<th align="left">area</th>
<th align="left">iter</th>
<th align="right">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1957</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">78360</td>
</tr>
<tr class="even">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1958</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">88785</td>
</tr>
<tr class="odd">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1959</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">105186</td>
</tr>
<tr class="even">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1960</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">117975</td>
</tr>
<tr class="odd">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1961</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">119541</td>
</tr>
<tr class="even">
<td align="left">catch</td>
<td align="left">all</td>
<td align="right">1962</td>
<td align="left">unique</td>
<td align="left">all</td>
<td align="left">unique</td>
<td align="left">1</td>
<td align="right">126290</td>
</tr>
</tbody>
</table>
</div>
<div id="flquant" class="section level2">
<h2><code>FLQuant</code></h2>
<p>Passing an <code>FLQuant</code> object to ggplot, we can specify the names of the dimensions as variables in the plot, where <code>data</code> refers to the column storing the actual numeric values. For example, to plot <em>data</em> (the <em>catch</em> slot from <code>ple4</code> in this case) against year, we could use</p>
<pre class="r"><code>ggplot(data = catch(ple4), aes(year, data)) + geom_point() + geom_line() + ylab(&quot;Catch (t)&quot;) + xlab(&quot;Year&quot;)</code></pre>
<p><img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/plotflquant-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>where we pass directly an <code>FLQuant</code> object for the <em>data</em> argument in <code>ggplot</code>, specify an aesthetic mapping (<code>aes(year, data)</code>), and add both points (<code>geom_point()</code>) and lines (<code>geom_line()</code>), together with the appropriate axis labels.</p>
</div>
<div id="flquants" class="section level2">
<h2><code>FLQuants</code></h2>
<p>Similarly, we can pass on to <code>ggplot</code> an object of class <code>FLQuants</code>, and the conversion to <code>data.frame</code> will make use of the corresponding method <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. A new column gives the name of each <code>FLQuant</code> in the list, called <em>qname</em>. We can then use it to, for example, define a call to <code>facet_wrap()</code> to obtain a separate subplot per element.</p>
<pre class="r"><code>ggplot(data=FLQuants(Yield=catch(ple4), SSB=ssb(ple4), F=fbar(ple4)), aes(year, data)) + 
  geom_line() + facet_wrap(~qname, scales=&quot;free_y&quot;, nrow=3) + labs(x=&quot;&quot;, y=&quot;&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/ggflqs-1.png" alt="Facet wrap line plot of time series from an FLQuants object." width="672" />
<p class="caption">
Facet wrap line plot of time series from an FLQuants object.
</p>
</div>
<p>This procedure is particularly useful when plotting information from objects with multiple <code>FLQuant</code> slots, because a subset of slots can be selected for plotting. Furthermore, transformations or computations can even be carried out in the call to the <code>FLQuants()</code> creator.</p>
</div>
<div id="flstock" class="section level2">
<h2><code>FLStock</code></h2>
<p>A whole <code>FLStock</code> object can also be used as argument to <code>ggplot()</code>, even if the heterogeneity in scale of the data contained makes the plot slightly confusing. For example, we can plot time-series of every <code>FLQuant</code> slot in <code>ple4</code>, with colour applied to different age dimensions, by calling</p>
<pre class="r"><code>ggplot(data=ple4, aes(year, data)) + geom_line(aes(group=age, colour=factor(age))) + 
  facet_wrap(~slot, scales=&quot;free&quot;, nrow=3) + labs(x=&quot;&quot;, y=&quot;&quot;) + theme(legend.position = &quot;none&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/ggfls-1.png" alt="Overall `ggplot` of an `FLStock` object, faceted by slot." width="2304" />
<p class="caption">
Overall <code>ggplot</code> of an <code>FLStock</code> object, faceted by slot.
</p>
</div>
</div>
</div>
<div id="new-plot-methods-for-flr-classes" class="section level1">
<h1>New <code>plot()</code> methods for FLR classes</h1>
<p>The <code>ggplotFL</code> package also provides new versions of the <code>plot</code> method for a number of <em>FLR</em> classes. Each <em>S4</em> class defined in any <em>FLR</em> package has a <code>plot()</code> method available that provides a quick visual summary of the contents of the object.</p>
<div id="flquant-1" class="section level2">
<h2><code>FLQuant</code></h2>
<p>The standard <code>plot()</code> method for <code>FLQuant</code> defined in <code>ggplotFL</code> uses the faceting capabilities of <code>ggplot</code> to better present some of the multiple dimensions of these objects. If any dimension, other than year and iter, has length greater than one, it will be added to the formula used by <code>facet_grid</code>. For example, an <code>FLQuant</code> with dimensions</p>
<pre class="r"><code>dim(catch.n(ple4))</code></pre>
<pre><code>[1] 10 61  1  1  1  1</code></pre>
<p>will generate a plot with a time series by year of the data it contains, with horizontal facets for the only dimension, other than year, of length greater than 1 (here age).</p>
<pre class="r"><code>plot(catch.n(ple4))</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflq-1.png" alt="Standard ggplot2-based plot for an FLQuant object with multiple *year*s and *age*s." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLQuant object with multiple <em>year</em>s and <em>age</em>s.
</p>
</div>
<p>For <code>FLQuant</code> objects with iterations, the <code>plot</code> method will calculate, by default, the 50% (median), 10%, 25%, 75% and 90% quantiles, to be plotted as a solid line (50%), a dotted line (10%, 90%) and a coloured ribbon (25%-75%).</p>
<pre class="r"><code>plot(rlnorm(200, fbar(ple4), 0.15))</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflq2-1.png" alt="Standard ggplot2-based plot for an FLQuant object with multiple iterations." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLQuant object with multiple iterations.
</p>
</div>
<p>Different quantiles can be specified using the <em>probs</em> arguments, and the alpha transparency of the ribbon will be proportional to the probability value. A vector of odd length must be passed, and the central point should be 0.50 so the central tendency line represents the median. The most extreme quantiles will be plotted as dotted lines, while all others will show up as ribbons.</p>
<pre class="r"><code>plot(rlnorm(200, fbar(ple4), 0.15), probs=c(0.05, 0.10, 0.25, 0.50, 0.75, 0.90, 0.95))</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflq3-1.png" alt="Standard ggplot2-based plot for an FLQuant object with multiple iterations and user-specified quantiles." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLQuant object with multiple iterations and user-specified quantiles.
</p>
</div>
</div>
<div id="flquants-1" class="section level2">
<h2><code>FLQuants</code></h2>
<p>The <code>plot</code> method for <code>FLQuants</code> will now by default show each object in a horizontal panel, with independent scales, by using <code>facet_grid</code>. Objects with iterations will have, as with <code>plot</code> for <code>FLQuant</code>, their median, 10%, 25%, 75% and 90% quantiles shown as a black line and red ribbons with different levels of transparency, respectively.</p>
<pre class="r"><code>fqs &lt;- FLQuants(F = rlnorm(200, fbar(ple4), 0.15), SSB = ssb(ple4), Rec = rec(ple4), Catch = catch(ple4))
plot(fqs)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflqs-1.png" alt="Standard ggplot2-based plot for an FLQuants object with multiple iterations, and consisting of four elements." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLQuants object with multiple iterations, and consisting of four elements.
</p>
</div>
<p>Plots of multiple <code>FLQuant</code> objects use by default <code>facet_grid</code> with multiple plots stacked on top of each other. To have the plots on a grid, you can add a call to <code>facet_wrap</code> to change it. For example, here we have a 2x2 grid</p>
<pre class="r"><code>fqs &lt;- FLQuants(F = rlnorm(200, fbar(ple4), 0.15), SSB = ssb(ple4), Rec = rec(ple4), Catch = catch(ple4))
plot(fqs) + facet_wrap(~qname, scales=&quot;free&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflqsg-1.png" alt="Wrap-based ggplot2-based plot for an FLQuants object with multiple iterations, and consisting of four elements." width="672" />
<p class="caption">
Wrap-based ggplot2-based plot for an FLQuants object with multiple iterations, and consisting of four elements.
</p>
</div>
</div>
<div id="flstock-1" class="section level2">
<h2><code>FLStock</code></h2>
<p>The <code>ggplotFL</code> version of the standard plot for the <code>FLStock</code> class contains the time series of recruitment (obtained by calling <code>rec()</code>), SSB (<code>ssb()</code>), catch (<code>catch()</code>), and fishing mortality or harvest for selected ages(<code>fbar()</code>). The four panels are now arranged in a 4-row matrix to better display the trends in the time series.</p>
<pre class="r"><code>plot(ple4)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pfls-1.png" alt="A ggplot2 version of the standard plot() for FLStock, as applied to `ple4`" width="672" />
<p class="caption">
A ggplot2 version of the standard plot() for FLStock, as applied to <code>ple4</code>
</p>
</div>
</div>
<div id="flstocks" class="section level2">
<h2><code>FLStocks</code></h2>
<p>Similarly, the standard <code>plot()</code> method for the <code>FLStocks</code> class now relies on <code>ggplot</code>. For example, we can create an example <code>FLStocks</code> object by splitting the female and male units of <code>ple4sex</code> and adding them as separate elements in the list. A call to <code>plot()</code> would give us the corresponding plot. Remember the object returned by <code>ggplot</code> can always be assigned to a variable in the workspace and modified as required (see examples below).</p>
<pre class="r"><code>plot(FLStocks(Male=ple4sex[,,&#39;male&#39;], Female=ple4sex[,,&#39;female&#39;])) + theme(legend.position=&quot;top&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflss-1.png" alt="ggplot2 version of the standard plot() for FLStocks, as applied to the sex-separated FLStock object `ple4sex`" width="672" />
<p class="caption">
ggplot2 version of the standard plot() for FLStocks, as applied to the sex-separated FLStock object <code>ple4sex</code>
</p>
</div>
</div>
<div id="flsr" class="section level2">
<h2><code>FLSR</code></h2>
<p>The <code>ggplotFL</code> version of the class plot for <code>FLSR</code> contains the same six panels as before:</p>
<ol style="list-style-type: decimal">
<li>stock-recruit data, fitted model and lowess smoother,</li>
<li>residuals by year,</li>
<li>lag 1-correlated residuals,</li>
<li>residuals by SSB,</li>
<li>residuals qqplot, and</li>
<li>residuals by fitted values.</li>
</ol>
<p>Blue lines are lowess smoothers, to better visualize trends in the data shown.</p>
<pre class="r"><code>plot(nsher)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflsr-1.png" alt="Standard ggplot2-based plot for an object of class FLSR." width="672" />
<p class="caption">
Standard ggplot2-based plot for an object of class FLSR.
</p>
</div>
</div>
<div id="flsrs" class="section level2">
<h2><code>FLSRs</code></h2>
<p>A class plot also exists for <code>FLSRs</code> objects, lists with <code>FLSR</code> elements. The comparison shown involves only the model fit across the different model functions or formulations, but not the residuals diagnostics available for <code>FLSR</code>. The default legend contains the formula of each of the fitted models and the parameter values (or the median if multiple iterations exist).</p>
<pre class="r"><code>srs &lt;- FLSRs(sapply(c(&#39;ricker&#39;, &#39;bevholt&#39;), function(x) {
         y &lt;- nsher
         model(y) &lt;- x
         return(fmle(y))}))</code></pre>
<pre class="r"><code>plot(srs)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflsrs-1.png" alt="Standard ggplot2-based plot for an FLSRs object, using default legend labels." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLSRs object, using default legend labels.
</p>
</div>
<p>An alternative labeller function exists (<em>modlabel</em>) that returns the name of the SR model function and the parameter values, by using the <em>legend_label</em> argument.</p>
<pre class="r"><code>plot(srs, legend_label=modlabel) </code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflsrs2-1.png" alt="Standard ggplot2-based plot for an FLSRs object, using model names as legend labels." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLSRs object, using model names as legend labels.
</p>
</div>
<p>As is common in <code>ggplot2</code>, labels can be specified directly, overwriting those included in the method. You should ignore the warning about scale for <em>color</em> being replaced.</p>
<pre class="r"><code>plot(srs) + scale_color_discrete(name=&quot;SR models&quot;, breaks=c(&#39;ricker&#39;, &#39;bevholt&#39;),
labels=c(&quot;Ricker&quot;, &quot;Beverton &amp; Holt&quot;))</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/pflsrs3-1.png" alt="Standard ggplot2-based plot for an FLSRs object, using model names as legend labels." width="672" />
<p class="caption">
Standard ggplot2-based plot for an FLSRs object, using model names as legend labels.
</p>
</div>
</div>
</div>
<div id="using-ggplot2-directly-by-converting-to-data.frame" class="section level1">
<h1>Using <code>ggplot2</code> directly by converting to <code>data.frame</code></h1>
<p>The methods shown above depend on conversion of <em>FLR</em> objects into <code>data.frame</code>, which can then be passed to <code>ggplot()</code>. Calling <code>ggplot</code> on an <em>FLR</em> object takes care of this conversion behind the scenes, but to obtain full control and develop certains plots, it is best to explicitely convert the <em>FLR</em> objects into a <code>data.frame</code>. Different conventions are used in the naming of the dataframe columns created from various <em>FLR</em> classes, which need to be used when the plot is specified. For further information, please see the help pages for each <code>data.frame()</code> method <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
</div>
<div id="some-examples" class="section level1">
<h1>Some examples</h1>
<div id="example-plot-quantiles-of-a-simulation" class="section level2">
<h2>Example: plot quantiles of a simulation</h2>
<p>To have full control over a plot of the median (or mean) and the confidence or probability intervals of a simulated or randomized time series, i.e. an <code>FLQuant</code> object with iters, we need to arrange the different values computed from the object in separate columns of a <code>data.frame</code>.</p>
<p>If we start with some random <code>FLQuant</code> object, such as</p>
<pre class="r"><code>fla &lt;- rlnorm(100, FLQuant(exp(cumsum(rnorm(25, 0, 0.1)))), 0.1) 
ggplot(fla, aes(factor(year), data)) + geom_boxplot() + xlab(&quot;&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/exsim1-1.png" alt="Distribution of values of a simulated time series plotted using geom_boxplot()" width="672" />
<p class="caption">
Distribution of values of a simulated time series plotted using geom_boxplot()
</p>
</div>
<p>We can first compute the necessary statistics on the object itself, as these operations are very efficient on an array. <code>quantile()</code> on an <code>FLQuant</code> will return the specified quantiles along the iter dimension. Let’s extract the 10th, 25th, 50th, 75th and 90th quantiles.</p>
<pre class="r"><code>flq &lt;- quantile(fla, c(0.10, 0.25, 0.50, 0.75, 0.90))</code></pre>
<p>The object can now be coerced to a <code>data.frame</code> and inspected to see how the 100 iters have now been turned into the five requested quantiles in the iter column</p>
<pre class="r"><code>fdf &lt;- as.data.frame(flq, drop=TRUE)
head(fdf, 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">iter</th>
<th align="right">data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">10%</td>
<td align="right">2.238</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">10%</td>
<td align="right">2.432</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">10%</td>
<td align="right">2.379</td>
</tr>
</tbody>
</table>
<p>The long-format <code>data.frame</code> can be reshaped into a wide-format one so that we can instruct <code>ggplot</code> to use the quantiles, now in separate columns, to provide limits for the shaded areas in <em>geom_ribbon</em>. To do this we can use <code>reshape</code>, as follows</p>
<pre class="r"><code>fdw &lt;- reshape(fdf, timevar = &quot;iter&quot;, idvar = c(&quot;year&quot;), direction = &quot;wide&quot;)</code></pre>
<p>This creates a wide <code>data.frame</code> in which the iter column is spread into five columns named as the levels of its conversion into factor</p>
<pre class="r"><code>levels(fdf[,&#39;iter&#39;])</code></pre>
<pre><code>[1] &quot;10%&quot; &quot;25%&quot; &quot;50%&quot; &quot;75%&quot; &quot;90%&quot;</code></pre>
<p>We can now use those five quantile columns when plotting shaded areas using <em>geom_ribbon</em>. Please note that the column names returned by <code>quantile()</code> need to be quoted using backticks.</p>
<pre class="r"><code>p &lt;- ggplot(data=fdw, aes(x=year, y=`data.50%`)) +
geom_ribbon(aes(x=year, ymin = `data.10%`, ymax = `data.90%`), fill=&quot;red&quot;, alpha = .15) +
geom_ribbon(aes(x=year, ymin = `data.25%`, ymax = `data.75%`), fill=&quot;red&quot;, alpha = .25) +
geom_line() + ylab(&quot;data&quot;)
print(p)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/exsim6-1.png" alt="Time series with 75% and 90% credibility intervals plotted using geom_ribbon." width="672" />
<p class="caption">
Time series with 75% and 90% credibility intervals plotted using geom_ribbon.
</p>
</div>
<p>Assigning the result of the call to <code>ggplot()</code> to a variable, as done above, will allow us to reuse the plot later on by modifying or adding components.</p>
</div>
<div id="example-simulation-trajectories-plot" class="section level2">
<h2>Example: Simulation trajectories plot</h2>
<p>If the result of a stochastic simulation is summarised by showing credibility intervals, it is very informative to plot as well some of the individual iterations (in this case we want iteration 1, 4 and 23) as a way of showing the fact that individual trajectories are generally not as smooth as, for example, the median shown in the figure above.</p>
<pre class="r"><code>fds  &lt;- as.data.frame(iter(fla, c(1, 4, 23)))
p + geom_line(data=fds, aes(year, data, colour=iter), size=0.5) + 
  theme(legend.position = &quot;none&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/exspa-1.png" alt="Spaghetti plot of a stochastic simulation, by calling geom_line on top of the stored ribbon plot." width="672" />
<p class="caption">
Spaghetti plot of a stochastic simulation, by calling geom_line on top of the stored ribbon plot.
</p>
</div>
<p>This is easy to do in <code>ggplot2</code> by adding an extra element on top of the previous plot, stored in the <code>p</code> object from the code above.</p>
</div>
<div id="example-using-flquants" class="section level2">
<h2>Example: Using <code>FLQuants</code></h2>
<p>Coercion using <code>as.data.frame</code>, combined with the use of <code>reshape</code>, or <code>dcast</code> and <code>melt</code> (from the <code>reshape2</code> package<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>), provides the <em>FLR</em> user with the tools required to create a large range of <code>ggplot</code>s from any <em>FLR</em> object.</p>
<p><strong>TODO</strong>: ADD text &amp; example</p>
</div>
<div id="example-bubble-plots" class="section level2">
<h2>Example: Bubble plots</h2>
<p>Bubble plots allow us to represent a third continuous dimension in a scatter plot by sizing points according the value of a variable. For example, catch in numbers by age and year can be visualised using</p>
<pre class="r"><code>ggplot(catch.n(ple4), aes(year, as.factor(age), size=data)) + geom_point(shape=21) + 
  scale_size(range = c(1, 20)) + ylab(&quot;age&quot;) + theme(legend.position = &quot;none&quot;)</code></pre>
<div class="figure" style="text-align: center">
<img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/exbub-1.png" alt="Bubble plot of catch by age in numbners for North Sea plaice." width="672" />
<p class="caption">
Bubble plot of catch by age in numbners for North Sea plaice.
</p>
</div>
<p>where <em>data</em> is used to size the bubbles in the call to <em>aes()</em>. This single line of code replaces the functionality offered by the <em>lattice</em>-based <code>bubbles()</code> method available in <code>FLCore</code>.</p>
</div>
<div id="example-residual-plots" class="section level2">
<h2>Example: Residual plots</h2>
<p>Residuals plots can be built, for example, for the numbers-at-age in the catch <code>FLQuant</code> by subtraction of the computed mean from the data. Then bubble plots can be built in <code>ggplot</code>, with size proportional to the residual and conditional colour coding for positive/negative residuals.</p>
<pre class="r"><code>dat &lt;- as.data.frame(catch.n(ple4))
dat$resid &lt;- dat$data - mean(dat$data)
ggplot(dat, aes(year, as.factor(age), size=resid)) +
  geom_point(shape=21, aes(colour=factor(sign(resid)), fill=factor(sign(resid)))) +
  scale_size(range = c(1, 20)) +
  scale_colour_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  scale_fill_manual(values=c(&quot;lightgray&quot;, &quot;black&quot;)) +
  ylab(&quot;age&quot;)</code></pre>
<p><img src="ggplotFL_plotting_FLR_objects_with_ggplot2_files/figure-html/exres-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Wilkinson, L. 1999. <em>The Grammar of Graphics</em>, Springer. <a href="http://dx.doi.org/10.1007/978-3-642-21551-3_13">doi 10.1007/978-3-642-21551-3_13</a></p>
</div>
<div id="more-information" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Or send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a></li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.5.2 (2018-12-20)</li>
<li>FLCore: 2.6.12</li>
<li>ggplotFL: 2.6.6</li>
<li>ggplot2: 3.1.0</li>
<li><strong>Compiled</strong>: Sun Mar 3 09:49:01 2019</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Giacomo Chato Osio</strong>, <strong>Iago MOSQUEIRA</strong>. European Commission Joint Research Centre (JRC), Institute for the Protection and Security of the Citizen (IPSC), Maritime Affairs Unit, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a></p>
<p><strong>Katell Hamon</strong> Wageningen UR. Wageningen Economic Research. Alexanderveld 5, The Hague, The Netherlands.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><code>method?as.data.frame('FLQuant')</code><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><code>method?as.data.frame('FLQuants')</code><a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>For example <code>method?as.data.frame('FLQuants')</code><a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p><a href="http://cran.r-project.org/package=reshape2" class="uri">http://cran.r-project.org/package=reshape2</a><a href="#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
