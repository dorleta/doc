<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Introductory example. Part 2.</title>

<script src="site_libs/header-attrs-2.1/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
    <li>
      <a href="Using_information_on_life_history_relationships.html">Using information on Life History relationships</a>
    </li>
    <li>
      <a href="Life_history_relationships.html">Life history relationships</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="Management_procedure_biomass_dynamic.html">Biomass Dynamic Management Procedures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    FLBEIA
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="FLBEIA_Conditioning.html">Conditioning FLBEIA using Smart Conditioning Functions</a>
    </li>
    <li>
      <a href="FLBEIA_A_Simple_Example.html">A simple example on how to use FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_An_Example_with_multiple_dimensions.html">A simple example with multiple dimensions in FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Checking_inputs.html">Checking FLBEIA inputs</a>
    </li>
    <li>
      <a href="FLBEIA_Using_Assessment_models_in_the_MP.html">Using Stock Assessment models in the Management procedure of FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Incorporating_SS3assessment_MP.html">Including SS3 assessment within the Management Procedure of FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Testing_Management_Strategies.html">Testing different Management Strategies in FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Data_Poor_MSE.html">Data Limited MSE in FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Smart_Conditioning_II.html">Smart Conditioning II</a>
    </li>
    <li>
      <a href="FLBEIA_Mixed_Fisheries_Tutorial.html">ICES Mixed Fisheries Advice using FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_Bio_Economic_Tutorial.html">Bio-Economic simulation using FLBEIA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Introductory example. Part 2.</h1>
<h4 class="date">15 may., 2020</h4>

</div>


<p><img src="images/FLBEIA_logo.png" width="20%" style="display: block; margin: auto;" /></p>
<div id="aim" class="section level1">
<h1>Aim</h1>
<p><strong>FLBEIA</strong> provides a battery of tutorials for learning how to use this software. This tutorial is a practical guide about a simple implementation of <code>FLBEIA</code> but with several fleets and stocks. The aim of this example is to become familiar with the required object for development of bio-economic impact assessments of fisheries management strategies.</p>
<p>In this tutorial a simple case study, named <code>multi</code> is explored and run in <code>FLBEIA</code>. Then, the outputs of <code>FLBEIA</code> are analized, summarized and plotted. Once the user has understood the structure and outputs of <code>FLBEIA</code>, let’s start playing! Several scenarios will be run. In the current tutorial, the scenarios will be related to the economic issues.</p>
</div>
<div id="help-manual" class="section level1">
<h1>Help &amp; Manual</h1>
<p><strong>FLBEIA</strong> includes extensive facilities for accessing documentation and searching for help. <strong>FLBEIA</strong> manual can be download from <a href="https://github.com/flr/FLBEIA/blob/master/vignettes/FLBEIA_manual.pdf">Github</a> or within the ‘doc’ folder of the package installation. Additionally, the <code>help()</code> function and <code>?</code> help operator in R provide access to the documentation pages. Typing <code>help(package = FLBEIA)</code> in the R console you access to the documentation for package <code>FLBEIA</code> , user guides and help pages. For example, typing <code>help(bioSum)</code> in the R console you access to help page of summary functions for the FLBEIA output.</p>
<p>The exact way to define the objects used to set the simulation is described in the <a href="https://github.com/flr/FLBEIA/blob/master/vignettes/FLBEIA_manual.pdf">FLBEIA manual</a>. Nevertheless, the objects to set the simulation do not need to be defined for the following examples, as the datasets <code>one</code> and <code>oneIt</code> from the FLBEIA package will be used. For details on these objects, see <a href="https://github.com/flr/FLBEIA/blob/master/vignettes/FLBEIA_manual.pdf">FLBEIA manual, Section 5.2</a> or type <code>?FLBEIA</code> in the R console.</p>
<p>To see all the datasets available in the <strong>FLBEIA</strong> package:</p>
<pre class="r"><code>data(package=&#39;FLBEIA&#39;)</code></pre>
</div>
<div id="required-packages-to-run-this-tutorial" class="section level1">
<h1>Required packages to run this tutorial</h1>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/ggplot2/index.html">ggplot2</a></li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLAssess/">FLAssess</a>, <a href="http://www.flr-project.org/FLash/">FLash</a>, <a href="http://www.flr-project.org/FLBEIA/">FLBEIA</a>, <a href="http://www.flr-project.org/FLFleet/">FLFleet</a>, [ggplotFL](<a href="http://www.flr-project.org/ggplotFL/" class="uri">http://www.flr-project.org/ggplotFL/</a></li>
</ul>
<p>If you are using Windows, please use 64-bit R version because some of the packages do not work in 32-bit.</p>
<pre class="r"><code>install.packages( c(&quot;ggplot2&quot;))
install.packages( c(&quot;FLCore&quot;, &quot;FLFleet&quot;, &quot;FLBEIA&quot;, &quot;ggplotFL&quot;, 
                    &quot;FLash&quot;, &quot;FLAssess&quot;, &quot;FLXSA&quot;), 
                  repos=&quot;http://flr-project.org/R&quot;)</code></pre>
<p>It has to be noted that packages <code>FLCore</code>, <code>FLFleets</code> and <code>FLBEIA</code> have to be installed in this exact order, as alternative orders can cause some problems.</p>
<p>The last version (not consolidated version -under development-) of FLBEIA can be installed from GitHub.</p>
<p>Load all the necessary packages.</p>
<pre class="r"><code># This chunk loads all necessary packages.
library(FLBEIA)
library(FLCore)
library(FLFleet)
library(FLXSA)
library(FLash)
library(ggplotFL)</code></pre>
</div>
<div id="example-2-stocks-2-fleets-with-two-metiers-each-4-seasons-and-1-iteration." class="section level1">
<h1>EXAMPLE: 2 stocks, 2 fleets with two metiers each, 4 seasons and 1 iteration.</h1>
<p><code>Multi</code> dataset has 2 stocks, <code>stk1</code> is age structured and <code>stk2</code> is aggregated in biomass. The historic data goes from 1990 to 2008 and projection from 2009 to 2025. The time step is seasonal, with 4 seasons (quarters) by year.</p>
<ul>
<li>Operating model: Population dynamics
<ul>
<li>Population dynamics of stk1: Age Structured Population Growth. Beverthon and Holt.</li>
<li>Population dynamics of stk2: Biomass Dynamic Population Growth. Pella-Tomlinson.</li>
<li>Fleet dynamics of fl1: Simple Mixed Fisheries Behaviour. Two metiers.</li>
<li>Fleet dynamics of fl2: Fixed effort. Two metiers</li>
<li>Covariates dynamics: Capital dynamics (SCD).</li>
</ul></li>
<li>Management Procedure
<ul>
<li>Observation: perfect observation</li>
<li>Assessment: no assessment</li>
<li>Management advice stk1: IcesHCR</li>
<li>Management advice stk2: Annual TAC</li>
</ul></li>
</ul>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>rm(list=ls())
data(multi)</code></pre>
<p><code>ls()</code> command return a vector of character strings giving the names of the objects in the environment, in this case we can see the objects stored in <code>multi</code>.</p>
<pre class="r"><code>ls()</code></pre>
<pre><code>character(0)</code></pre>
<p>Show the class of each of the objects with <code>sapply</code> function.</p>
<pre class="r"><code># Show the class of each of the objects.
sapply(ls(), function(x) class(get(x)))</code></pre>
<pre><code>named list()</code></pre>
</div>
<div id="run-flbeia." class="section level2">
<h2>Run FLBEIA.</h2>
<p>In the code below <code>FLBEIA</code> is run with the arguments stored in dataset <code>multi</code>.</p>
<pre class="r"><code>SM &lt;- FLBEIA(biols = multiBio,       # FLBiols object with 2 FLBiol element for stk1.
               SRs = multiSR,        # A list with 1 FLSRSim object for stk1.
               BDs = multiBD,        # A list with 1 FLBDSim object for stk2.
            fleets = multiFl,        # FLFleets object with on fleet.
            covars = multiCv,        # A list with socio - economic data.         
           indices = NULL,           # Indices not available.
            advice = multiAdv,       # A list with two elements &#39;TAC&#39; and &#39;quota.share&#39;.
         main.ctrl = multiMainC,     # A list with one element to define the start/end 
                                     # of the simulation.
        biols.ctrl = multiBioC,      # A list with one element to select the model 
                                     # to simulate the stock dynamics.
       fleets.ctrl = multiFlC,       # A list with several elements to select fleet
                                     # dynamic models and store additional parameters.
       covars.ctrl = multiCvC,       # Covars control (additional data for capital dynamics).
          obs.ctrl = multiObsC,      # A list with one element to define how the 
                                     # stock observed (&quot;PerfectObs&quot;).
       assess.ctrl = multiAssC,      # A list with one element to define how the 
                                     # stock assesSMent model used (&quot;NoAssesSMent&quot;).
       advice.ctrl = multiAdvC)      # A list with one element to define how the TAC advice 
                                     # is obtained (&quot;IcesHCR&quot;).</code></pre>
<p><code>FLBEIA</code> function returns a list with several objects, let’s print the names of the objects and their classes.</p>
<pre class="r"><code>names(SM)</code></pre>
<pre><code> [1] &quot;biols&quot;         &quot;fleets&quot;       
 [3] &quot;covars&quot;        &quot;advice&quot;       
 [5] &quot;stocks&quot;        &quot;indices&quot;      
 [7] &quot;BDs&quot;           &quot;SRs&quot;          
 [9] &quot;fleets.ctrl&quot;   &quot;pkgs.versions&quot;</code></pre>
</div>
<div id="summarizing-results" class="section level2">
<h2>Summarizing results</h2>
<p><code>FLBEIA</code> has several functions to summaryze the results in data frames (<code>bioSum</code>, <code>fltSum</code>, etc.). These data frames will allow us to use methods available in R to visualize and analyze the results. Information can be summarized in two formats:</p>
<ul>
<li>Long format: There is one column, named indicator, for storing the name of the indicator and a second column for the numeric value of the indicator. The long format is recommendable to work with <code>ggplot2</code> functions.</li>
<li>Wide format: where each column corresponds to one indicator. The wide format is more efficient in terms of memory allocation and speed of computation.</li>
</ul>
<p>The quantile version of the summaries, (<code>bioSumQ</code>, <code>fltSumQ</code>, etc.), returns the quantiles of indicators.</p>
</div>
<div id="summary-functions" class="section level2">
<h2>Summary functions</h2>
<ul>
<li><p><strong>advSum</strong>, <strong>advSumQ</strong>: Data frame with indicators related to the management advice (TAC). Indicators are: “catch”, “discards”, “discRat”, “landings”, “quotaUpt” and “tac”.</p></li>
<li><p><strong>bioSum</strong>, <strong>bioSumQ</strong>: Data frame with the biological indicators. Indicators are: “biomass”, “catch”, “catch.iyv”, “discards”, “disc.iyv”, “f”, “landings”, “land.iyv”, “rec” and “ssb”.</p></li>
<li><p><strong>fltSum</strong>, <strong>fltSumQ</strong>: Data frame with indicators at fleet level. Indicators are: “capacity”, “catch”, “costs”, “discards”, “discRat”, “effort”, “fcosts”, “gva”, “grossValue”, “landings”, “fep”, “nVessels”, “price”, “grossSurplus”, “netProfit”, “quotaUpt”, “salaries”, “vcosts” and “profitability”. Definition of economics indicators:</p>
<ul>
<li>discRat: Discount rate.</li>
<li>grossValue: value of landings (landings x prices)</li>
<li>Operating costs: Landing Fee x Gross value + Fuel cost x Effort + Other variable costs x effort + Fixed costs x Vessel.</li>
<li>Gross Value added: Gross value - Operating Costs</li>
<li>fep: Full equity profit defined as Gross Surplus - depreciation costs</li>
<li>grossSurplus: Gross value added - Labour costs, where Labour costs: share of the landings x Gross value + Fixed labour costs x Crew.</li>
<li>Oportunity costs: Capital x interest rate free of risk.</li>
<li>netProfit: fep - Oportunity costs</li>
<li>quotaUpt: Quota uptaken.</li>
<li>profitability: grossSurplut/Gross Value</li>
</ul></li>
<li><p><strong>fltStkSum</strong>, <strong>fltStkSumQ</strong> : Data frame with indicators at fleet and stock level. Indicators are: “landings”, “discards”, “catch”, “price”, “quotaUpt”, “tacshare”, “discRat” and “quota”.</p></li>
<li><p><strong>npv</strong>: A data frame with the net present value per fleet over the selected range of years.</p></li>
<li><p><strong>mtSum</strong>, <strong>mtSumQ</strong> : Data frame with indicators at fleet level. Indicators are: “effshare”, “effort”, “income” and “vcost”.</p></li>
<li><p><strong>mtStkSum</strong>, <strong>mtStkSumQ</strong> : Data frame with indicators at fleet and metier level. Indicators are: “catch”, “discards”, “discRat”, “landings” and “price”.</p></li>
<li><p><strong>riskSum</strong>: A data frame with the risk indicators. Indicators are: “pBlim”, “pBpa” and “pPrflim”.</p></li>
<li><p><strong>vesselSum</strong>, <strong>vesselSumQ</strong>: Data frame with Indicators at vessel level. Indicators are: “catch”, “costs”, “discards”, “discRat”, “effort”, “fcosts”, “gva”, “income”, “landings”, “netProfit”, “price”, “profits”, “quotaUpt”, “salaries”, “vcosts” and “profitability”.</p></li>
<li><p><strong>vesselStkSum</strong>, <strong>vesselStkSumQ</strong>: Data frame with indicators at vessel and stock level. Indicators are: “landings”, “discards”, “catch”, “price”, “quotaUpt”, “tacshare”, “discRat” and “quota”.</p></li>
<li><p><strong>summary_flbeia</strong>: An array with four dimensions: stock, year, iteration, indicator. Indicators are: “recruitment”, “ssb”, “f”, “biomass”, “catch”, “landings” and “discards”.</p></li>
<li><p><strong>ecoSum_damara</strong>: ecoSum function built in the framework of Damara project.</p></li>
</ul>
<div id="long-format." class="section level3">
<h3>Long format.</h3>
<pre class="r"><code>SM$fleets &lt;- setUnitsNA(SM$fleets)
SM_bio    &lt;- bioSum(SM, long = TRUE)          # Data frame (DF) with biological indicators.
SM_adv    &lt;- advSum(SM, long = TRUE)          # DF with indicators related with man. advice (TAC). 
SM_flt    &lt;- fltSum(SM, long = TRUE)          # DF with indicators at fleet level.
SM_fltStk &lt;- fltStkSum(SM, long = TRUE)       # DF with indicators at fleet and stock level.
SM_mt     &lt;- mtSum(SM, long = TRUE)           # DF with indicators at fleet.
SM_mtStk  &lt;- mtStkSum(SM, long = TRUE)        # DF with indicators at fleet and metier level.
SM_vessel &lt;- vesselSum(SM, long = TRUE)       # DF with indicators at vessel level.
SM_vesselStk &lt;- vesselStkSum(SM, long = TRUE) # DF with indicators at vessel and stock level.
SM_npv  &lt;- npv(SM, y0 = &#39;2014&#39;)               # DF with net present value per fleet over 
                                              # the selected range of years.
SM_risk &lt;- riskSum(SM,  Bpa= c(stk1= 135000, stk2 = 124000), Blim =c(stk1 = 96000, stk2 = 89000),
                   Prflim = c(fl1 = 0, fl2 = 0), flnms = names(SM$fleets), 
                   years = dimnames(SM$biols[[1]]@n)[[2]], 
                   scenario = &#39;SM&#39;) # DF with risk indicators (pBlim, pBpa and pPrlim).


# Exploring data frames
head(SM_bio); unique(SM_bio$indicator)
head(SM_adv); unique(SM_adv$indicator)
head(SM_flt); unique(SM_flt$indicator)
head(SM_fltStk); unique(SM_fltStk$indicator)
head(SM_mt); unique(SM_mt$indicator)
head(SM_mtStk); unique(SM_mtStk$indicator)
head(SM_vessel); unique(SM_vessel$indicator)
head(SM_vesselStk); unique(SM_vesselStk$indicator)
head(SM_risk); unique(SM_risk$indicator)</code></pre>
</div>
<div id="wide-format." class="section level3">
<h3>Wide format.</h3>
<pre class="r"><code>SM_bio_l    &lt;- bioSum(SM, long = FALSE)            
SM_adv_l    &lt;- advSum(SM, long = FALSE)             
SM_flt_l    &lt;- fltSum(SM, long = FALSE)            
SM_fltStk_l &lt;- fltStkSum(SM, long = FALSE)          
SM_mt_l     &lt;- mtSum(SM, long = FALSE)             
SM_mtStk_l  &lt;- mtStkSum(SM, long = FALSE)           
SM_vessel_l &lt;- vesselSum(SM, long = FALSE)          
SM_vesselStk_l &lt;- vesselStkSum(SM, long = FALSE) 

# Exploring data frames
head(SM_bio_l, 2)
head(SM_adv_l, 2)
head(SM_flt_l, 2)
head(SM_fltStk_l, 2)
head(SM_mt_l, 2)
head(SM_mtStk_l, 2)
head(SM_vessel_l, 2)
head(SM_vesselStk_l, 2)</code></pre>
</div>
<div id="plotting-results" class="section level3">
<h3>Plotting results</h3>
<p>You can show results using the default plots in <strong>FLCore</strong> package.</p>
<pre class="r"><code>#plot(SM$biols[[1]]) # There are too much data to display them correctly.
plot(SM$stocks[[1]]) # Stock 2 is in biomass, &#39;plot(SM$stocks[[2]])&#39; function does not work.</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-12-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Additionally you can plot results using <code>plotFLBiols</code>, <code>plotFLFleets</code> and <code>plotCatchFl</code>. The plots will be saved in your working directory as a pdf file.</p>
<pre class="r"><code># set your own working directory.
#myWD &lt;- &quot;C:/use/escritorio/ExampleMulti/&quot;
#setwd(myWD)
plotFLBiols(SM$biols, pdfnm = &quot;SM&quot;)
plotFLFleets(SM$fleets, pdfnm =&quot;SM&quot;)
plotfltStkSum(SM, pdfnm =&quot;SM&quot;) 
plotEco(SM, pdfnm =&#39;SM&#39;)</code></pre>
<p>You can also use the function <code>ggplot</code> to generate additional figures. In the current example we will plot the economic related outputs.</p>
<pre class="r"><code>inds &lt;- c(&#39;catch&#39;,&#39;nVessels&#39;, &#39;effort&#39;, &#39;grossValue&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=fleet)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>inds &lt;- c(&#39;capacity&#39;, &#39;grossValue&#39;, &#39;costs&#39;, &#39;netProfit&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=fleet)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-14-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="lets-play" class="section level2">
<h2>LET`S PLAY</h2>
<p>In this example the economic information is available. In this section we will focus on economic variables, processess and indicators.</p>
<div id="price" class="section level3">
<h3>Price</h3>
<p>Imagine that the unit of the prices are wrong, the price should be by tonnes instead by kilogram because the units of catches are tonnes. Then, we can solve the error multipliying the all prices by 1000.</p>
<pre class="r"><code>for (i in names(multiFl)) {
  for(j in names(multiFl[[i]]@metiers)) {
    for(k in names(multiFl[[i]]@metiers[[j]]@catches)) {
      multiFl[[i]]@metiers[[j]]@catches[[k]]@price &lt;- 
        multiFl[[i]]@metiers[[j]]@catches[[k]]@price*1000
    }
  }
}  </code></pre>
<p>Run FLBEIA and generate the base case scenario.</p>
<pre class="r"><code>SM &lt;- FLBEIA(biols = multiBio,   SRs = multiSR,  BDs = multiBD, fleets = multiFl, covars = multiCv,
             indices = NULL,advice = multiAdv, main.ctrl = multiMainC, biols.ctrl = multiBioC,
             fleets.ctrl = multiFlC, covars.ctrl = multiCvC, obs.ctrl = multiObsC, assess.ctrl = multiAssC,
             advice.ctrl = multiAdvC)     </code></pre>
<div id="summarzing-the-results" class="section level4">
<h4>Summarzing the results</h4>
<pre class="r"><code>SM$fleets &lt;- setUnitsNA(SM$fleets)
SM_bio    &lt;- bioSum(SM, long = TRUE)          # Data frame (DF) with biological indicators.
SM_adv    &lt;- advSum(SM, long = TRUE)          # DF with indicators related with man. advice (TAC). 
SM_flt    &lt;- fltSum(SM, long = TRUE)          # DF with indicators at fleet level.
SM_fltStk &lt;- fltStkSum(SM, long = TRUE)       # DF with indicators at fleet and stock level.
SM_mt     &lt;- mtSum(SM, long = TRUE)           # DF with indicators at fleet.
SM_mtStk  &lt;- mtStkSum(SM, long = TRUE)        # DF with indicators at fleet and metier level.
SM_vessel &lt;- vesselSum(SM, long = TRUE)       # DF with indicators at vessel level.
SM_vesselStk &lt;- vesselStkSum(SM, long = TRUE) # DF with indicators at vessel and stock level.
SM_npv  &lt;- npv(SM, y0 = &#39;2014&#39;) # DF with net present value per fleet over a selected range of years.
SM_risk &lt;- riskSum(SM, stknms = names(SM$biols), Bpa= c(stk1= 135000, stk2 = 124000), 
                   Blim =c(stk1 = 96000, stk2 = 89000),
                   Prflim = c(fl1 = 0, fl2 = 0), flnms = names(SM$fleets), 
                   years = dimnames(SM$biols[[1]]@n)[[2]], 
                   scenario = &#39;SM&#39;) #  DF with risk indicators (pBlim, pBpa and pPr).</code></pre>
</div>
<div id="plots" class="section level4">
<h4>Plots</h4>
<pre class="r"><code>plotFLBiols(SM$biols, pdfnm = &quot;SM_pricex1000&quot;)
plotFLFleets(SM$fleets, pdfnm =&quot;SM_pricex1000&quot;)
plotfltStkSum(SM, pdfnm =&quot;SM_pricex1000&quot;) 
plotEco(SM, pdfnm =&#39;SM_pricex1000&#39;)</code></pre>
<p>You can also use the function <code>ggplot</code> to generate additional figures.</p>
<pre class="r"><code>inds &lt;- c(&#39;capacity&#39;,&#39;costs&#39;, &#39;grossValue&#39;, &#39;gva&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=fleet)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Plotting some biological indicators</p>
<pre class="r"><code>inds &lt;- c(&#39;ssb&#39;,&#39;rec&#39;, &#39;biomass&#39;, &#39;catch&#39;)
d &lt;- rbind(subset(SM_bio,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=stock)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Plotting TAC</p>
<pre class="r"><code>plotFLBiols(SM$biols, pdfnm = &quot;SM_pricex1000&quot;)
plotFLFleets(SM$fleets, pdfnm =&quot;SM_pricex1000&quot;)
plotfltStkSum(SM, pdfnm =&quot;SM_pricex1000&quot;) 
plotEco(SM, pdfnm =&#39;SM_pricex1000&#39;)</code></pre>
<pre class="r"><code>inds &lt;- c(&#39;tac&#39;)
d &lt;- rbind(subset(SM_adv,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=stock)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="price-dynamics" class="section level3">
<h3>Price Dynamics</h3>
<p>The price function is <code>fixedprice</code>: prices are given as input data and are unchanged within the simulation. Now change the price dynamics defining <code>elasticPrice</code> model in one fleet <code>fl1</code> and stock <code>stk2</code>. For a detailed description of this function see page 19 of the <a href="https://github.com/flr/FLBEIA/blob/master/vignettes/FLBEIA_manual.pdf">Manual</a>. The price dynamics function implemented in FLBEIA is described in Kraak et al. [2004]. This function set a base price and base landings to calculate the new price using an elasticity parameter. If the base landings are bigger than current landings the price is increased and decreased if the contrary occurs. Although price is stored at metier and stock level in <code>FLFleetsExt</code>,this function assumes that is common to all metiers within a fleet and it is calculated at fleet level.</p>
<pre class="r"><code># Describe the price function
multiFlC_1 &lt;- multiFlC
multiFlC_1$fl1$stk2$price.model &lt;- &quot;elasticPrice&quot; # Set the price model.

# Include the new paramenter (elasticity)
multiFl_1 &lt;- multiFl 
elasticity &lt;- 0.5 # We assume that the elasticity is 0.2.
multiFlC_1$fl1$stk2$pd.els &lt;-  array(elasticity, dim = c(1, 4, 1),
                                     dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1)) 

# Reference landings: year 2008
La0_met1 &lt;- multiFl$fl1@metiers$met1@catches$stk2@landings.n[,as.character(2008),,,] * 
                multiFl$fl1@metiers$met1@catches$stk2@landings.wt[,as.character(2008),,,]
La0_met2 &lt;- multiFl$fl1@metiers$met2@catches$stk2@landings.n[,as.character(2008),,,] * 
                multiFl$fl1@metiers$met2@catches$stk2@landings.wt[,as.character(2008),,,]
pd.La0 &lt;- unitSums(La0_met1 +La0_met2) 
                   
multiFlC_1$fl1$stk2$pd.La0 &lt;- array(pd.La0, dim = c(1,4, 1),
                                   dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1))

# Reference price
Pa0_met1 &lt;- multiFl$fl1@metiers$met1@catches$stk2@price[,as.character(2008),,,] 
Pa0_met2 &lt;- multiFl$fl1@metiers$met2@catches$stk2@price[,as.character(2008),,,]  
pd.Pa0 &lt;- unitMeans((La0_met1*Pa0_met1 +La0_met2*Pa0_met2)/(La0_met1+La0_met2))

multiFlC_1$fl1$stk2$pd.Pa0 &lt;- array(pd.Pa0,  dim = c(1,4, 1),
                                   dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1))

multiFlC_1$fl1$stk2$pd.total &lt;- TRUE # If TRUE: price is calculated using total landings, and 
                                     # if FALSE: fleet&#39;s landings are used to estimate the price.


SM_1 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_1,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC_1, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC)</code></pre>
<p>Plot price and grossValue to see the impact that the price dynamics have on the results.</p>
<pre class="r"><code>SM_1$fleets &lt;- setUnitsNA(SM_1$fleets)
SM_1_fltStk &lt;- fltStkSum(SM_1, scenario =&#39;elasticPrice&#39;, long = TRUE) 
SM_x &lt;- rbind(SM_fltStk, SM_1_fltStk)

inds &lt;- c(&#39;price&#39;, &#39;catch&#39;, &#39;effort&#39;, &#39;capacity&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl1&#39; &amp; stock == &#39;stk2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>SM_1_flt &lt;- fltSum(SM_1, scenario =&#39;elasticPrice&#39;, long = TRUE) 
SM_x &lt;- rbind(SM_flt, SM_1_flt)
SM_x &lt;- subset(SM_x, fleet == &#39;fl1&#39;)

inds &lt;- c(&#39;grossValue&#39;,&#39;costs&#39;,&#39;salaries&#39;,&#39;netProfit&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="fixed-costs" class="section level3">
<h3>Fixed Costs</h3>
<p>Fixed costs (repair, maintenance and other) of <code>fl1</code> decreases 80%. How does this decrease impacts on the economic results?</p>
<pre class="r"><code>multiFl_2 &lt;- multiFl
multiFl_2$fl1@fcost &lt;- multiFl_2$fl1@fcost*(1-0.8)
SM_2 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_2,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>We can visualize the results of both simulations (SM aganist SM_2) using ggplot.</p>
<pre class="r"><code>SM_2$fleets &lt;- setUnitsNA(SM_2$fleets)
SM_2_flt    &lt;- fltSum(SM_2, scenario = &#39;SM_2&#39;, long = TRUE)
SM_x &lt;- rbind(SM_flt, SM_2_flt)

inds &lt;- c(&#39;costs&#39;,&#39;fcosts&#39;,&#39;grossValue&#39;,&#39;netProfit&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl1&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-costs" class="section level3">
<h3>Variable Costs</h3>
<p>Variable costs decreases a 50% for <code>fl2</code> and for metiers <code>met1</code> and <code>met2</code>. How does this decrease affect to the economic results?</p>
<pre class="r"><code>multiFl_3 &lt;- multiFl
multiFl_3$fl2@metiers$met1@vcost &lt;- multiFl_3$fl2@metiers$met1@vcost*(1-0.5)
multiFl_3$fl2@metiers$met2@vcost &lt;- multiFl_3$fl2@metiers$met2@vcost*(1-0.5)

SM_3 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_3,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>Compare results aganist base case scenario.</p>
<pre class="r"><code>SM_3$fleets &lt;- setUnitsNA(SM_3$fleets)
SM_3_flt    &lt;- fltSum(SM_3, scenario = &#39;SM_3&#39;, long = TRUE)

inds &lt;- c(&#39;costs&#39;,&#39;vcosts&#39;,&#39;grossValue&#39;,&#39;netProfit&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds &amp; fleet == &#39;fl2&#39;),
            subset(SM_3_flt, indicator %in% inds  &amp; fleet == &#39;fl2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="crewshare" class="section level3">
<h3>Crewshare</h3>
<p>Now, imagine that the crew share remuneration system changes for ``fl1```` and now the percentage of crew share is 50%.</p>
<pre class="r"><code>multiFl_4 &lt;- multiFl
multiFl_4$fl1@crewshare[] &lt;- 0.5

SM_4 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_4,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>Compare results aganist base case scenario.</p>
<pre class="r"><code>SM_4$fleets &lt;- setUnitsNA(SM_4$fleets)
SM_4_flt    &lt;- fltSum(SM_4, scenario = &#39;SM_4&#39;, long = TRUE)

inds &lt;- c(&#39;costs&#39;,&#39;vcosts&#39;,&#39;grossValue&#39;,&#39;netProfit&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds &amp; fleet == &#39;fl1&#39;),
            subset(SM_4_flt, indicator %in% inds  &amp; fleet == &#39;fl1&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="capital-dynamics" class="section level3">
<h3>Capital dynamics</h3>
<p>The current capital function in <code>fixedCapital</code>, where the capacity and catchability are given as input data and are unchanged within the simulation. Now change the capital function and implement the <code>SCD</code>function. In this simple function catchability is not updated, it is an input parameter, and only capacity is updated depending on some economic indicators. For more detailed information of this function, see the page 20 of the <a href="https://github.com/flr/FLBEIA/blob/master/vignettes/FLBEIA_manual.pdf">Manual</a>.</p>
<p>Firstly define requiered variables.:</p>
<pre class="r"><code># SCD2
SCD2 &lt;- 
  function (fleets, covars, fleets.ctrl, flnm, year = 1, season = 1, 
  ...) 
{
  fleet &lt;- fleets[[flnm]]
  ny &lt;- dim(fleet@effort)[2]
  ns &lt;- dim(fleet@effort)[4]
  it &lt;- dim(fleet@effort)[6]
  VaC &lt;- seasonSums(totvcost_flbeia(fleet)[, year])
  FxC &lt;- seasonSums(covars[[&quot;NumbVessels&quot;]][flnm, ] * fleet@fcost)[, 
    year]
  FuC &lt;- seasonSums(covars[[&quot;FuelCost&quot;]][flnm, ] * fleet@effort)[, 
    year]
  CaC &lt;- seasonMeans((covars[[&quot;CapitalValue&quot;]][flnm, ] * covars[[&quot;NumbVessels&quot;]][flnm, 
    ]))[, year]
  Rev &lt;- revenue_flbeia(fleet)[, year]
  Rev &lt;- ifelse(Rev == 0, 1e-16, Rev)
  CrC &lt;- seasonSums((Rev * fleet@crewshare[, year] + covars[[&quot;Salaries&quot;]][flnm, 
    year]))
  Rev &lt;- seasonSums(Rev)
  x1 &lt;- FuC/Rev
  units(VaC) &lt;- units(Rev)

  x2 &lt;- VaC/Rev
  a &lt;- CrC + FxC + CaC
  b &lt;- 1 - x1 - x2
units(a) &lt;- units(b)
  BER &lt;- a/b
  Inv &lt;- c((Rev - BER)/Rev) * c(covars[[&quot;InvestShare&quot;]][flnm, 
    year, , ns])
  Inv &lt;- ifelse((Rev - BER) &lt; 0 &amp; Rev &lt; 0, -Inv, Inv)
  Ks &lt;- fleet@capacity[, year][drop = T]
  K &lt;- c(seasonSums(fleet@capacity[, year]))
  if (ns == 1) 
    pKs &lt;- rep(1, it)
  else if (it &gt; 1) 
    pKs &lt;- sweep(Ks, 2, K, &quot;/&quot;)
  else pKs &lt;- Ks/K
  w1 &lt;- c(covars[[&quot;w1&quot;]][flnm, year, , ns])
  w2 &lt;- c(covars[[&quot;w2&quot;]][flnm, year, , ns])
  omega &lt;- ifelse(Inv &lt; 0, ifelse(-Inv &lt; w1, Inv * K, -w1 * 
    K), ifelse(Inv &lt; w2, Inv * K, w2 * K))
  Ef &lt;- c(seasonSums(fleet@effort[, year]))
  iterSel &lt;- which(omega &gt; 0 &amp; Ef &lt; 0.99 * K)
  omega[iterSel] &lt;- 0
  if (year &lt; ny) {
    fleets[[flnm]]@capacity[, year + 1] &lt;- Ks + omega * 
      pKs
    covars[[&quot;NumbVessels&quot;]][flnm, year + 1, ] &lt;- fleets[[flnm]]@capacity[, 
      year + 1]/(covars[[&quot;MaxDays&quot;]][flnm, year + 1, ])
  }
  return(list(fleets = fleets, covars = covars))
  }

list2env(list(SCD2=SCD2), globalenv())


# fl1 has fixed effort
multiFlC_5 &lt;- multiFlC
multiFlC_5$fl2$capital.model &lt;- multiFlC_5$fl2$capital.model &lt;- &#39;SCD2&#39;

multiCv_5 &lt;- multiCv
multiCv_5$w1[] &lt;- 0.01  
multiCv_5$w2[] &lt;- 0.01
multiCv_5$InvestShare[] &lt;- 0.02
  
SM_5 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl,
                covars = multiCv_5, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
                biols.ctrl = multiBioC, fleets.ctrl = multiFlC_5, covars.ctrl = multiCvC,
                obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC)</code></pre>
<p>Now, compare results of SM_5 against base case scenario.</p>
<pre class="r"><code>SM_5$fleets &lt;- setUnitsNA(SM_5$fleets)
SM_5_flt    &lt;- fltSum(SM_5, scenario = &#39;SM_5&#39;, long = TRUE)
SM_x &lt;- rbind( SM_flt, SM_5_flt )

inds &lt;- c(&quot;capacity&quot;,&#39;nVessels&#39;,&#39;effort&#39;,&#39;netProfit&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)

p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>There are no differences between scenarios because in SCD investment in new vessels will only occur if the operational days of existing vessels is equal to maximum days. Additionally, data of this example is not real and there are some extrange results due to the conditioning.</p>
</div>
</div>
<div id="visualizing-results-with-flbeiaapp" class="section level2">
<h2>Visualizing results with flbeiaApp</h2>
<p>Currently is under development, but soon you will be able to run the <code>flbeiaApp</code> to built an interactive web applications for visualizing data. Currently this a preliminary version or beta versi?n of the <code>flbeiaApp</code>.</p>
<pre class="r"><code>scnms &lt;-c(&#39;SM&#39;, &#39;SM_1&#39;, &#39;SM_2&#39;, &#39;SM_3&#39;, &#39;SM_4&#39;, &#39;SM_5&#39;)
stknms &lt;- unique(SM_bio$stock)
RefPts &lt;- expand.grid(indicator=c(&quot;Bmsy&quot;, &quot;Fmsy&quot;, &quot;Bpa&quot;, &quot;Blim&quot;, &quot;Fpa&quot;, &quot;Flim&quot;), 
                      scenario=scnms, stock=stknms, value=NA)[,c(3,2,1,4)]
RefPts$value &lt;- c(c(800, 0.11, 800, 550, 0.25, 0.50), c(800, 0.2, 800, 550, 0.25, 0.50), 
                  c(800, 0.2, 800, 550, 0.25, 0.50), c(800, 0.2, 800, 550, 0.25, 0.50), 
                  c(800, 0.2, 800, 550, 0.25, 0.50), c(800, 0.2, 800, 550, 0.25, 0.50))

flbeiaObjs &lt;- list( SM = SM, SM_1 = SM_1, SM_2 = SM_2, SM_3 = SM_3,
                    SM_4 = SM_4, SM_5 = SM_5)


flbeiaApp(flbeiaObjs = flbeiaObjs, RefPts = RefPts, years = ac(2000:2025), 
          calculate_npv = TRUE, npv.y0 = &#39;2012&#39;, npv.yrs = ac(2013:2025)) </code></pre>
</div>
<div id="exercises" class="section level2">
<h2>EXERCISES</h2>
<p>Run the following scenarios and compare them with the baseline scenario (bc). The comparison should be done numerically and/or plotting scenarios results.</p>
<ul>
<li>sE1: Capacity: Capaticy of the fl1 decreases a 10%. What is it the economics impacts?</li>
<li>sE2: Crewshare: The crew share of both fleets increases a 20%. What is it the economics impacts?</li>
<li>sE4: Effort dynamics: Use <code>MaxProfit</code> effort function for the fl1.</li>
<li>sE5: Price dynamics: Increase by 20% the price of the recruits for both stoks.</li>
<li>sE6: Fleet dynamics: The legislation has changed and the mesh size of the vessel will be changed, decreasing the catchability of vessels by 10%. What will be the biological and economics impacts of this legislation?</li>
</ul>
</div>
</div>
<div id="more-information" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Or send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a></li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
<li>You can submit bug reports, questions or suggestions specific to <strong>FLBEIA</strong> to <a href="mailto:flbeia@azti.es" class="email">flbeia@azti.es</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 4.0.0 (2020-04-24)</li>
<li>FLCore: 2.6.15</li>
<li>FLBEIA: 1.15.4</li>
<li>FLFleet: 2.6.1</li>
<li>FLash: 2.5.11</li>
<li>FLAssess: 2.6.3</li>
<li>FLXSA: 2.6.4</li>
<li>ggplotFL: 2.6.7.9006</li>
<li>ggplot2: 3.3.0</li>
<li><strong>Compiled</strong>: Fri May 15 07:05:17 2020</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Marga Andres</strong> AZTI. Marine Reserach Unit. Txatxarramendi Ugartea z/g, 48395, Sukarrieta, Basque Country, Spain. ** Mail** <a href="mailto:mandres@azti.es" class="email">mandres@azti.es</a></p>
<p><strong>FLBEIA TEAM</strong> AZTI. Marine Reserach Unit. Txatxarramendi Ugartea z/g, 48395, Sukarrieta, Basque Country, Spain. ** Mail** <a href="mailto:flbeia@azti.es" class="email">flbeia@azti.es</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
