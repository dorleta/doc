<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>A quick introduction to FLR</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
    <li>
      <a href="Using_information_on_life_history_relationships.html">Using information on Life History relationships</a>
    </li>
    <li>
      <a href="Life_history_relationships.html">Life history relationships</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="Management_procedure_biomass_dynamic.html">Biomass Dynamic Management Procedures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    FLBEIA
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="An_introduction_to_MSE_using_FLR.html">An introduction to MSE using FLR</a>
    </li>
    <li>
      <a href="Conditioning_FLBEIA.html">Conditioning FLBEIA using Smart Conditioning Functions</a>
    </li>
    <li>
      <a href="FLBEIA_A_Simple_Example.html">A simple example on how to use FLBEIA</a>
    </li>
    <li>
      <a href="FLBEIA_An_Example_with_multiple_dimensions.html">A simple example with multiple dimensions in FLBEIA</a>
    </li>
    <li>
      <a href="Using_Assessment_models_in_the_MP_FLBEIA.html">Using Stock Assessment models in the Management procedure of FLBEIA</a>
    </li>
    <li>
      <a href="Testing_Management_Strategies_in_FLBEIA.html">Testing different Management Strategies in FLBEIA</a>
    </li>
    <li>
      <a href="Data_Poor_MSE_in_FLBEIA.html">Data Limited MSE in FLBEIA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A quick introduction to FLR</h1>
<h4 class="date">08 August, 2019</h4>

</div>


<p>The Fisheries Library in R (FLR) is a collection of tools for quantitative fisheries science, developed in the R language, that facilitates the construction of bio-economic simulation models of fisheries systems as well as the application of a wide range of quantitative analysis.</p>
<p>FLR builds on the powerful R environment and syntax to create a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">domain-specific language</a> for the quantitative analysis of the expected risks and impacts of fisheries management decisions. The classes and methods in FLR consider uncertainty an integral part of our knowledge of fisheries systems.</p>
<div id="required-packages" class="section level2">
<h2>Required packages</h2>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>CRAN: latticeExtra, gridExtra, ggplot2</li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLa4a/">FLa4a</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a>, <a href="http://www.flr-project.org/FLBRP/">FLBRP</a>, <a href="http://www.flr-project.org/FLash/">FLash</a></li>
</ul>
<p>You can do so as follows:</p>
<pre class="r"><code>install.packages(c(&quot;latticeExtra&quot;, &quot;gridExtra&quot;, &quot;ggplot2&quot;, &quot;triangle&quot;, &quot;copula&quot;, &quot;coda&quot;, &quot;mgcv&quot;))
install.packages(c(&quot;FLCore&quot;, &quot;ggplotFL&quot;, &quot;FLa4a&quot;, &quot;FLBRP&quot;, &quot;FLash&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
</div>
<div id="classes-and-methods" class="section level1">
<h1>Classes and methods</h1>
<p>The <em>FLCore</em> package defines a series of data structures that represent different elements of the fishery system. These structures are defined using R’s S4 class system, while functions to operate on those classes are defined as methods. In this way function call (e.g. <code>plot()</code>) can be used on different classes and their behaviour is consistent with the class structure and content. For further information on the S4 class system, please look at the <a href="https://stat.ethz.ch/R-manual/R-patched/library/methods/html/Introduction.html">introductory text on the <strong>methods</strong> package</a>.</p>
<div id="flquant" class="section level2">
<h2>FLQuant</h2>
<p>The <a href="http://www.flr-project.org/FLCore/reference/FLQuant.html">FLQuant</a> class is the basic data structure for <strong>FLR</strong>, and it is in essence a 6D array on which data and outputs can be stored, structured along dimensions related to time, space, age or length, etc. It is also able to keep track of the units of measurement employed, as a simple character vector, although various operations on these objects are aware of the units of measurements contained in them.</p>
<p>We will be creating an altering <em>FLQuant</em> objects as we go along, but we can long briefly at some basic operations, as the syntax will then be used in other classes in <em>FLR</em>.</p>
<p>Let’s first load the necessary packages in our session. The <strong>FLCore</strong> paxckage</p>
<pre class="r"><code>library(FLCore)
library(ggplotFL)</code></pre>
<p>As it is the case for R classes, for example <em>data.frame</em>, classes in <em>FLR</em> can be constructed using a constructor method with the same name as the class, in this case <code>FLQuant()</code>.</p>
<pre class="r"><code>FLQuant(1:10)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
quant 1  2  3  4  5  6  7  8  9  10
  all  1  2  3  4  5  6  7  8  9 10

units:  NA </code></pre>
<p>The <em>FLQuant</em> constructor can take a variety of inputs, like a vector, a matrix or an array, and also allows you to specify a nuber of arguments. We will only look now at three of them, <code>units</code> for the units of measurement, <code>quant</code> for the name of the first dimension, and <code>dimnames</code> for the dimension names of the object. For example, to construct an object holding (random) data in tonnes on catches for ages 1 to 4, over a period of 6 years, one could call</p>
<pre class="r"><code>flq &lt;- FLQuant(rlnorm(60), dimnames=list(age=1:4, year=2012:2017), units=&quot;t&quot;)

flq</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.60352 0.97440 0.99065 1.68515 1.36443 5.05653
  2 1.93833 2.09946 3.13919 0.84972 0.53418 0.69980
  3 0.24826 1.51710 5.28007 0.61229 0.59522 1.19544
  4 3.14748 6.16351 1.06234 0.93561 1.43151 0.81529

units:  t </code></pre>
<p>The object has six dimensions, although some of them (<code>unit</code>, <code>season</code>, <code>area</code> and <code>iter</code>) ar not used in this case. We can inspect the object in various ways</p>
<pre class="r"><code># A summary of structure and data
summary(flq)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot; with:
dim  :  4 6 1 1 1 1 
quant:  age 
units:  t 

Min    :  0.2482592 
1st Qu.:  0.7864159 
Mean   :  1.789145 
Median :  1.12889 
3rd Qu.:  1.978613 
Max    :  6.163509 
NAs    :  0 %</code></pre>
<pre class="r"><code># dimnames
dimnames(flq)</code></pre>
<pre><code>$age
[1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot;

$year
[1] &quot;2012&quot; &quot;2013&quot; &quot;2014&quot; &quot;2015&quot; &quot;2016&quot; &quot;2017&quot;

$unit
[1] &quot;unique&quot;

$season
[1] &quot;all&quot;

$area
[1] &quot;unique&quot;

$iter
[1] &quot;1&quot;</code></pre>
<pre class="r"><code># dims
dim(flq)</code></pre>
<pre><code>[1] 4 6 1 1 1 1</code></pre>
<pre class="r"><code># units
units(flq)</code></pre>
<pre><code>[1] &quot;t&quot;</code></pre>
<p>It can be also subset and modified</p>
<pre class="r"><code># Extract first year
flq[, 1]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012   
  1 0.60352
  2 1.93833
  3 0.24826
  4 3.14748

units:  t </code></pre>
<pre class="r"><code># Extract year 2013
flq[, &quot;2013&quot;]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2013  
  1 0.9744
  2 2.0995
  3 1.5171
  4 6.1635

units:  t </code></pre>
<pre class="r"><code># Set catches on age 1 to zero
flq[1,] &lt;- 0
flq</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
  2 1.93833 2.09946 3.13919 0.84972 0.53418 0.69980
  3 0.24826 1.51710 5.28007 0.61229 0.59522 1.19544
  4 3.14748 6.16351 1.06234 0.93561 1.43151 0.81529

units:  t </code></pre>
<p>as it can be used in many operations</p>
<pre class="r"><code># Product with scalar
flq * 10</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
  2 19.3833 20.9946 31.3919  8.4972  5.3418  6.9980
  3  2.4826 15.1710 52.8007  6.1229  5.9522 11.9544
  4 31.4748 61.6351 10.6234  9.3561 14.3151  8.1529

units:  NA </code></pre>
<pre class="r"><code># Addition with another FLQuant
flq + (flq * 0.20)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
  2 2.32600 2.51935 3.76703 1.01966 0.64102 0.83976
  3 0.29791 1.82052 6.33608 0.73475 0.71427 1.43453
  4 3.77698 7.39621 1.27480 1.12273 1.71781 0.97834

units:  t </code></pre>
<pre class="r"><code># Sum along years
yearSums(flq)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 1      
  1  0.0000
  2  9.2607
  3  9.4484
  4 13.5557

units:  t </code></pre>
<div id="more-information" class="section level3">
<h3>More information</h3>
<p>To learn more about the class, check the <a href="http://www.flr-project.org/FLCore/reference/FLQuant.html">FLQuant help page</a>.</p>
</div>
</div>
</div>
<div id="loading-your-data" class="section level1">
<h1>Loading your data</h1>
<p>The first step in an analysis is to get the relevant data into the system. We will need to construct objects of certain <strong>FLR</strong> classes, but first data is loaded into the R session using any of the tools available in the language: <code>read.csv</code> for CSV files, <code>readVPA</code> and others for fisheries legacy file formats, …</p>
<p>In this example we will create an object of class <em>FLStock</em>, a representation of both inputs and outputs involved in fitting a stock assessment model, from a CSV file containing a table with five columns:</p>
<ul>
<li><em>slot</em>, the name of the input quantity, in this case either landings at age, <em>landings.n</em>, weight-at-age in the landings, <em>landings.wt</em>, and the same quantitieds for discards, <em>discards.n</em> and <em>discards.wt</em>.</li>
<li><em>age</em> and <em>year</em></li>
<li><em>data</em>, the numeric values themselves.</li>
<li><em>units</em>, a character string for the units of measurement employed: <em>kg</em> and <em>1000</em> in this case for kilograms and thousands.</li>
</ul>
<p>The file is downloaded into a temporary folder, and uncompressed. Simply change the value of <code>dir</code> to save the file in another folder.</p>
<pre class="r"><code>dir &lt;- tempdir()
download.file(&quot;http://www.flr-project.org/doc/src/ple4.csv.zip&quot;, file.path(dir, &quot;ple4.csv.zip&quot;))
unzip(file.path(dir, &quot;ple4.csv.zip&quot;), exdir=dir)</code></pre>
<p>The CSV file can now be loaded as a <code>data.frame</code> using <code>read.csv</code> and inspected</p>
<pre class="r"><code>dat &lt;- read.csv(file.path(dir, &quot;ple4.csv&quot;))
head(dat)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">slot</th>
<th align="right">age</th>
<th align="right">year</th>
<th align="right">data</th>
<th align="left">units</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">1</td>
<td align="right">1957</td>
<td align="right">32356</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">2</td>
<td align="right">1957</td>
<td align="right">45596</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">3</td>
<td align="right">1957</td>
<td align="right">9220</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">4</td>
<td align="right">1957</td>
<td align="right">909</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">5</td>
<td align="right">1957</td>
<td align="right">961</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">6</td>
<td align="right">1957</td>
<td align="right">25</td>
<td align="left">1000</td>
</tr>
</tbody>
</table>
<p>This data.frame contains the time series of landings and discards at age, in thousands, and the corresponding mean weights-at-age, in kg, for <a href="http://standardgraphs.ices.dk/ViewCharts.aspx?key=8980">North Sea plaice</a> (<em>Pleuronectes platessa</em>, ICES ple.27.420).</p>
<p>We can create an object to store the landings-at-age data by subsetting it from the <em>data.frame</em></p>
<pre class="r"><code>landn &lt;- subset(dat, slot==&quot;landings.n&quot;, select=-slot)</code></pre>
<p>and then convert into an <em>FLQuant</em> using</p>
<pre class="r"><code>landsn &lt;- as.FLQuant(landn)</code></pre>
<p>The object can now be inspected and plotted using the FLR-defined methods</p>
<pre class="r"><code>summary(landsn)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot; with:
dim  :  10 52 1 1 1 1 
quant:  age 
units:  1000 

Min    :  0 
1st Qu.:  4548.25 
Mean   :  28140.75 
Median :  14029.5 
3rd Qu.:  40536 
Max    :  274209 
NAs    :  0 %</code></pre>
<pre class="r"><code>plot(landsn)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotlandings.n-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In a similar way, we can now convert the input <em>data.frame</em>, containing data for four data elements, as specified in the <code>slots</code> column, into an <em>FLStock</em> object, <code>ple4</code></p>
<pre class="r"><code>nple4 &lt;- as.FLStock(dat)

summary(nple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    1   10  

catch         : [ 1 52 1 1 1 1 ], units =  NA 
catch.n       : [ 10 52 1 1 1 1 ], units =  NA 
catch.wt      : [ 10 52 1 1 1 1 ], units =  NA 
discards      : [ 1 52 1 1 1 1 ], units =  NA 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  NA 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  NA 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<p>To complete this <em>FLStock</em> object we will need to specify the natural mortality, <em>m</em>, in this case as a constant value of 0.1 for all ages and years,</p>
<pre class="r"><code>m(nple4) &lt;- 0.1</code></pre>
<p>the proportion of natural and fishing mortality that takes place before spawning, assumed to be zero in both cases,</p>
<pre class="r"><code>m.spwn(nple4) &lt;- harvest.spwn(nple4) &lt;- 0</code></pre>
<p>and the maturity at age, as the proportion mature, as a vector repeated for all years.</p>
<pre class="r"><code>mat(nple4) &lt;- c(0, 0.5, 0.5, rep(1, 7))</code></pre>
<p>We now must compute the overall landings and discards, in biomass, from the age-disaggregated values,</p>
<pre class="r"><code>landings(nple4) &lt;- computeLandings(nple4)
discards(nple4) &lt;- computeDiscards(nple4)</code></pre>
<p>and then the catch slots from both landings and discards</p>
<pre class="r"><code>catch(nple4) &lt;- computeCatch(nple4, slot=&quot;all&quot;)</code></pre>
<p>The mean weigth-at-age in the stock needs to be provided. In this case we will assume it is the same as the one computed from the catch sampling programme</p>
<pre class="r"><code>stock.wt(nple4) &lt;- catch.wt(nple4)</code></pre>
<p>We finalize by specifying the fully selected age range, used in the calculation of an overall index of fishing mortality, for example as the mean, using <code>fbar()</code>, or as the maximum value, using <code>fapex()</code> across those ages. This information is part of the object’s <em>range</em>.</p>
<pre class="r"><code>range(nple4, c(&quot;minfbar&quot;, &quot;maxfbar&quot;)) &lt;- c(2, 6)</code></pre>
<p>If we now inspect the resulting object we can see that all calculated slots have been assigned the corresponding <em>units</em> of measurement, except for those that will hold the estimates coming from a stock assessment model: <em>stock</em>, <em>stock.n</em> and <em>stock.wt</em> for the estimates of abundance, and <em>harvest</em> for the estimates of fishing mortality at age.</p>
<pre class="r"><code>summary(nple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    2   6   

catch         : [ 1 52 1 1 1 1 ], units =  t 
catch.n       : [ 10 52 1 1 1 1 ], units =  1000 
catch.wt      : [ 10 52 1 1 1 1 ], units =  kg 
discards      : [ 1 52 1 1 1 1 ], units =  t 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  t 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  kg 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<pre class="r"><code>plot(metrics(nple4, Catch=catch, Landings=landings))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/nple4-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>data(ple4)</code></pre>
<div id="more-information-1" class="section level3">
<h3>More information</h3>
<p>Please see the <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a> tutorial for more examples on how to get your data into into <strong>FLR</strong>.</p>
</div>
</div>
<div id="visualizing-and-plotting" class="section level1">
<h1>Visualizing and plotting</h1>
<p>As already shown, <strong>FLR</strong> classes have always a <code>plot</code> methods defined that provide a basic visual exploration of the object contents. But you are not limited to those plots, and other methods are available to allow you to build the plots you need.</p>
<p>The <em>FLCore</em> package provides a set of those plot methods based on R’s <a href="https://cran.r-project.org/web/packages/lattice/index.html">lattice package</a>, as well as versions of lattice’s methods that work directly on <strong>FLR</strong> objects, for example <code>xyplot</code></p>
<pre class="r"><code>xyplot(data~year|age, harvest(ple4), xlab=&quot;&quot;, ylab=&quot;&quot;, type=&quot;b&quot;, cex=0.5, pch=19)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/xyplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>But the <em>ggplotFL</em> package, which we have already loaded, provides a new set of plot methods based on <a href="http://ggplot2.tidyverse.org/">ggplot2</a>, from which all the plots shown so far in this tutorial have been generated.</p>
<p>One important advantage of <em>ggplot2</em> is that plots are returned as objects that can be modified and extended. For example, the basic plot for the abundances at age <em>FLQuant</em> using <em>ggplotFL</em> would be this one</p>
<pre class="r"><code>plot(stock.n(ple4))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotstockn-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>in which each age is shown in a different horizontal panel (<em>facet</em>). Now we can modify this plot in various ways by adding extra <em>ggplot2</em> commands to it, for example by adding a label to the <code>y</code> axis, shading a certain period of interest</p>
<pre class="r"><code>plot(stock.n(ple4)) +
  # Add y label
  ylab(&quot;Biomass (t)&quot;) +
  # Draw rectangle between years 1990 and 2000
  annotate(&quot;rect&quot;, xmin = 1990, xmax = 2000, ymin = 0, ymax = Inf,
    # in semi-transparent red
    alpha = .2, fill=&#39;red&#39;)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotstocknplus-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The basic method in <em>ggplot2</em> taking a data input, <code>ggplot</code>, has also been defined for some <em>FLCore</em> class, which simpliefies constructing plots based on objects of those classes from scratch. For example, we can plot our catch-at-age matrix from <em>ple4</em> to show the signal of strong cohorts in the data using</p>
<pre class="r"><code>ggplot(data=catch.n(ple4), aes(x=year, y=data, group=age)) +
  geom_line(aes(colour=as.factor(age))) +
  ylab(&quot;Total catch (t)&quot;) + xlab(&quot;&quot;) + theme(legend.position=&quot;none&quot;)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotcatchn-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><em>ggplotFL</em> deals with multiple iterations in <strong>FLR</strong> objects by calculating quantiles along the <em>iter</em> dimension and plotting them as areas and lines. For example, an object with random lognormal noise around the catch time series would look like this</p>
<pre class="r"><code>plot(rlnorm(250, log(catch(ple4)), 0.5))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotcatch-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>where the 50% and 95% intervals are shown as a red region and a dotted line respectively, while the median value is shown as a black line.</p>
<p>Note that plot methods on both <em>FLCore</em> and <em>ggplotFL</em> work by converting various <strong>FLR</strong> objects to a class that <em>lattice</em> and <strong>gplot2</strong> can understand, <em>data.frame</em>s. Coercing a 6D array like an <em>FLQuant</em> to a 2D <em>data.frame</em> requires generating one column per dimension, named as those, plus an extra column for the values stored in the object. This column is named <code>data</code>, thus the use of <code>data</code> in various plot formulas above. For classes with multiple slots, like <em>FLStock</em>, an extra column is necessary, which will be called <code>slots</code>. Please check <a href="http://www.flr-project.org/FLCore/reference/coerce-methods.html">this help page</a> to know more about the coertion methods for <strong>FLR</strong> objects.</p>
<div id="more-information-2" class="section level3">
<h3>More information</h3>
<p>For further explanations on the use of the two plotting platforms available for <strong>FLR</strong> classes, please refer to the <a href="http://www.flr-project.org/doc/ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL plotting FLR objects with ggplot2</a> and <a href="http://www.flr-project.org/doc/Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a> tutorials.</p>
</div>
</div>
<div id="running-a-stock-assessment" class="section level1">
<h1>Running a stock assessment</h1>
<p>An important step in providing management advice for a fish stock is the estimation of current status, past history and stock productivity through an stock assessment (SA) model. The <em>FLStock</em> object we have created contains some of the inputs required for most SA models: catches, natural mortality, and maturity. What is now needed is some indication of changes in abundance over the period of exploitation, an index of abundance, derived from either research surveys or catch-per-unit-effort of commercial fleets.</p>
<div id="index-of-abundance" class="section level2">
<h2>Index of abundance</h2>
<p>An index of abundance for the North Sea plaice stock, as an object of class <a href="http://www.flr-project.org/FLCore/reference/FLIndex.html">FLIndex</a>, is available as an example dataset in <em>FLCore</em>, and can be loaded using the <em>data</em> command</p>
<pre class="r"><code>data(ple4.index)</code></pre>
<p>This time series of abundances at age, covering from 1996 to 2017, was obtained during the <a href="http://ocean.ices.dk/Project/IBTS/">ICES International Bottom Trawl Survey</a>, as is one of the indices used by the Working Group on the Assessment of Demersal Stocks in the North Sea and Skagerrak (WGNSSK).</p>
<p>The <em>FLIndex</em> class is able to contain not only the index of abundance, in this case as an age-structured <em>FLQuant</em>, but also other information on variance, associated catches, effort, selectivity and catchability, which might be used by certain methods.</p>
<pre class="r"><code>summary(ple4.index)</code></pre>
<pre><code>An object of class &quot;FLIndex&quot;

Name: BTS-Combined (all) 
Description: Plaice in IV                                            . Imported from VPA file. 
Type :  numbers 
Distribution :   
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  22  1   1   1   1   

Range:  min max pgroup  minyear maxyear startf  endf 
    1   10  1   1996    2017    0.6453376   0.6453376   

index         : [ 10 22 1 1 1 1 ], units =  NA 
index.var     : [ 10 22 1 1 1 1 ], units =  NA 
catch.n       : [ 10 22 1 1 1 1 ], units =  NA 
catch.wt      : [ 10 22 1 1 1 1 ], units =  NA 
effort        : [ 1 22 1 1 1 1 ], units =  NA 
sel.pattern   : [ 10 22 1 1 1 1 ], units =  NA 
index.q       : [ 10 22 1 1 1 1 ], units =  NA </code></pre>
<pre class="r"><code>plot(ple4.index)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/summaryple4index-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <em>range</em> slot in this class contains information about the time period over which the survey takes place, as proportions of the year, in this case from the beginning of August to the end of September.</p>
<pre class="r"><code>range(ple4.index)[c(&quot;startf&quot;, &quot;endf&quot;)]</code></pre>
<pre><code>   startf      endf 
0.6453376 0.6453376 </code></pre>
</div>
<div id="a4a-statistical-catch-at-age" class="section level2">
<h2>a4a statistical catch-at-age</h2>
<p>The <a href="http://flr-project.org/FLa4a">FLa4a</a> package provides an <strong>FLR</strong> implementation of the <em>a4a</em> model, an statistical catch-at-age model of medium complexity that has been designed to make use of the power and flexibility of R’s formula-based model notation (as used for example in <a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/lm.html">lm</a>), while giving access to a solid and fast minimization algorithm implemented using <a href="http://www.admb-project.org/">AD Model Builder</a>.</p>
<pre class="r"><code>library(FLa4a)</code></pre>
<p>A first go at fitting this model to the <em>ple4</em> and <em>ple4.index</em> datasets requires a single line of code</p>
<pre class="r"><code>fit &lt;- sca(ple4, FLIndices(BTS=ple4.index))</code></pre>
<p>This returns an object of class a4aFitSA that contains the results fo the model fit, including the estimated catch-at-age, and the derived abundances and fishing mortality at age</p>
<pre class="r"><code>summary(fit)</code></pre>
<pre><code>An object of class &quot;a4aFitSA&quot;

Name: PLE 
Description: Plaice in IV. ICES WGNSSK 2018. FLAAP 
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  61  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2017    2   6   

stock.n       : [ 10 61 1 1 1 1 ], units =  1000 
harvest       : [ 10 61 1 1 1 1 ], units =  f 
catch.n       : [ 10 61 1 1 1 1 ], units =  1000 </code></pre>
<p>which we can use to update the <em>FLStock</em> object</p>
<pre class="r"><code>stk &lt;- ple4 + fit
plot(stk)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/ple4fit-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Among other methods, <em>FLa4a</em> provides a range of tools for inspecting the quality of the model fit. For example, a set of residuals, for the fits to both the index olf abundance and</p>
<div id="more-information-3" class="section level3">
<h3>More information</h3>
<p>Please see the <a href=".html"></a> tutorial for more examples on how to .</p>
</div>
</div>
</div>
<div id="exploring-the-stock-recruitment-relationship" class="section level1">
<h1>Exploring the stock-recruitment relationship</h1>
<p>Fitting a model for the relationship between stock abundance and expected recruitment is necessary for forecasting the future dynamics of the stock under various levels of fishing mortality, the central element of fisheries management advice. Certain stock assessment models, for example most statistical catch-at-age models, include the stock-recruitment model in the estimated parameters, but for others, like Virtual Population Analysis, this is a setup carried out once the stock of population abundace have been obtained.</p>
<p>Both inputs and outputs for stock-recruitment models are stored in an object of the <a href="http://www.flr-project.org/FLCore/reference/FLSR.html">FLSR</a> class which we can create directly from the SA results by coertion using</p>
<pre class="r"><code>plsr &lt;- as.FLSR(stk)</code></pre>
<p>The resulting <em>FLSR</em> object contains the series of recruitment <code>rec</code>, the abundance of the first age, and the stock reproductive potential, in this case the spawning stock biomass <code>ssb</code>. Both series are already displaced as corresponds by the age of recruitment, 1 in this case.</p>
<pre class="r"><code>summary(plsr)</code></pre>
<pre><code>An object of class &quot;FLSR&quot;

Name: PLE 
Description: &#39;rec&#39; and &#39;ssb&#39; slots obtained from a &#39;FLStock&#39; object 
Quant: age 
Dims:  age  year    unit    season  area    iter
    1   60  1   1   1   1   

Range:  min minyear max maxyear 
    1   1958    1   2017    

rec           : [ 1 60 1 1 1 1 ], units =  1000 
ssb           : [ 1 60 1 1 1 1 ], units =  kg 
residuals     : [ 1 60 1 1 1 1 ], units =  NA 
fitted        : [ 1 60 1 1 1 1 ], units =  1000 

Model:  list()
Parameters: 
    params
iter
   1
Log-likelihood:  NA(NA) 
Variance-covariance: &lt;0 x 0 matrix&gt;</code></pre>
<p>We now need to choose a model to fit, and <em>FLCore</em> provides a number of them already defined in terms of:</p>
<ul>
<li>the model formula, kept in the <code>model</code> slot</li>
<li>a function returning the log-likelihood, to be used for minimization, in the <code>logl</code> slot</li>
<li>a function to obtain initial values for the minimization procedure, in the <code>initial</code> slot</li>
</ul>
<p>See the <a href="http://www.flr-project.org/FLCore/reference/FLSR.html">SR Models</a> help page for further details of the available models.</p>
<p>We can now assign the output of the chosen model function, in this case <code>ricker()</code> to the existing object using</p>
<pre class="r"><code>model(plsr) &lt;- ricker()</code></pre>
<p>The model object is ready to fit, through Maximum Likelihood Estimation (MLE), using the <code>fmle</code> method defined in <em>FLCore</em>. This makes use of R’s <code>optim</code>, but defaults to the Melder-Mead algorithm.</p>
<pre class="r"><code>plsr &lt;- fmle(plsr)</code></pre>
<p>Another look at the object ill show us that a number of slots now contain the results of the model fit, among them:</p>
<ul>
<li><code>fitted</code> for the estimated recruitment, as an <em>FLQuant</em></li>
<li><code>residuals</code> for the residuals in log space, <em>FLQuant</em></li>
<li><code>params</code> for the estimated parameters, as an object of class <em>FLPar</em></li>
<li><code>vcov</code> for the variance-covariance matrix, as an <em>array</em></li>
</ul>
<p>The standard plot for the class shows the model fit and a series of useful diagnostics that will help us evaluating the its quality and usefulness for future projections. This can be further explored by likelihood profiling over a range of values of the estimated parameters, simply calling the <code>profile</code> method of the object</p>
<pre class="r"><code>profile(plsr)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/flsrprofile-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, the model can be used to predict future recruitments if provided with a set of new of values of SSB, as in</p>
<pre class="r"><code>predict(plsr, ssb=FLQuant(rnorm(10, 25e4, sd(ssb(plsr))), dimnames=list(age=1, year=2008:2017)))</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2008      2009      2010      2011      2012      2013      2014     
  1 -10008692   1322964     45880    957730    893855    872758  -1209982
   year
age 2015      2016      2017     
  1    805894  -1329512   1032422

units:  1000 </code></pre>
<div id="more-information-4" class="section level3">
<h3>More information</h3>
<p>Please see the <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a> tutorial for more examples and information on the stock-recruitment model fitting capabilities of <strong>FLR</strong>.</p>
</div>
</div>
<div id="estimating-reference-points" class="section level1">
<h1>Estimating reference points</h1>
<p>To assess current and future status of a stock we need reference points which he hold to represent desirable states for the stock, usually either in terms of stock abundance, like <span class="math inline">\(B_{MSY}\)</span>, the biomass expected to produce, on average and under the current exploitation pattern, the Maximum Sustainable Yield (<span class="math inline">\(MSY\)</span>), or of fishing mortality, such as the fishing mortality expected to produce <span class="math inline">\(MSY\)</span>, <span class="math inline">\(F_{MSY}\)</span>.</p>
<p>We can use the <a href="http://flr-project.org/FLBRP">FLBRP package</a> to calculate a large set of reference points, once we have an estimate of stock status, our <em>FLStock</em> object, and of the stock-recruitment relationship, <em>FLSR</em>. We can use them both to create the necessary object, of class <em>FLBRP</em>, after loading the package</p>
<pre class="r"><code>library(FLBRP)
plrp &lt;- FLBRP(stk, sr=plsr)
summary(plrp)</code></pre>
<pre><code>An object of class &quot;FLBRP&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  101 1   1   1   1   

Range:  min max pgroup  minfbar maxfbar 
    1   10  10  2   6   

fbar          : [ 1 101 1 1 1 1 ], units =  f 
fbar.obs      : [ 1 61 1 1 1 1 ], units =  f 
landings.obs  : [ 1 61 1 1 1 1 ], units =  t 
discards.obs  : [ 1 61 1 1 1 1 ], units =  t 
rec.obs       : [ 1 61 1 1 1 1 ], units =  1000 
ssb.obs       : [ 1 61 1 1 1 1 ], units =  t 
stock.obs     : [ 1 61 1 1 1 1 ], units =  t 
profit.obs    : [ 1 61 1 1 1 1 ], units =  NA 
landings.sel  : [ 10 1 1 1 1 1 ], units =  NA 
discards.sel  : [ 10 1 1 1 1 1 ], units =  NA 
bycatch.harv  : [ 10 1 1 1 1 1 ], units =  f 
stock.wt      : [ 10 1 1 1 1 1 ], units =  kg 
landings.wt   : [ 10 1 1 1 1 1 ], units =  kg 
discards.wt   : [ 10 1 1 1 1 1 ], units =  kg 
bycatch.wt    : [ 10 1 1 1 1 1 ], units =  NA 
m             : [ 10 1 1 1 1 1 ], units =  m 
mat           : [ 10 1 1 1 1 1 ], units =   
harvest.spwn  : [ 10 1 1 1 1 1 ], units =   
m.spwn        : [ 10 1 1 1 1 1 ], units =   
availability  : [ 10 1 1 1 1 1 ], units =  NA 
price         : [ 10 1 1 1 1 1 ], units =  NA 
vcost         : [ 1 1 1 1 1 1 ], units =  NA 
fcost         : [ 1 1 1 1 1 1 ], units =  NA 

Model:  rec ~ a * ssb * exp(-b * ssb)
Parameters: 
    params
iter    a        b
   1 4.81 1.33e-06

refpts:  calculated </code></pre>
<p>An object of the <em>FLBRP</em> class contains a series of times series of observations on dynamics of both stock and fishery, as well as average quantities computed along an specified time period. A series of slot are designed to contain economic variables, such as <code>price</code>, variable costs (<code>vcost</code>) and fixed costs (<code>fcost</code>), which will need to be provided. When those data are available, economic reference points can also be calculated. Finally, a vector of fishing mortality values, <code>fbar</code>, has been created, by default to be of length 101 and with values going from <span class="math inline">\(F=0\)</span> to <span class="math inline">\(F=4\)</span>, to be used in the calculation procedure.</p>
<p>We can now proceed with the calculation of reference points, through the <code>brp</code> method</p>
<pre class="r"><code>plrp &lt;- brp(plrp)</code></pre>
<p>and the extraction of the values obtained, stored in the <code>refpts</code> slot of the object</p>
<pre class="r"><code>refpts(plrp)</code></pre>
<pre><code>An object of class &quot;FLPar&quot;
        quant
refpt    harvest  yield    rec      ssb      biomass  revenue  cost    
  virgin 0.00e+00 0.00e+00 6.14e+05 2.10e+06 2.16e+06       NA       NA
  msy    2.63e-01 1.03e+05 1.31e+06 8.89e+05 1.01e+06       NA       NA
  crash  5.10e-01 9.18e-07 1.71e-05 3.56e-06 4.87e-06       NA       NA
  f0.1   1.52e-01 8.28e+04 1.06e+06 1.37e+06 1.47e+06       NA       NA
  fmax   2.05e-01 9.73e+04 1.20e+06 1.13e+06 1.25e+06       NA       NA
  spr.30 1.91e-01 9.43e+04 1.17e+06 1.20e+06 1.31e+06       NA       NA
  mey          NA       NA       NA       NA       NA       NA       NA
        quant
refpt    profit  
  virgin       NA
  msy          NA
  crash        NA
  f0.1         NA
  fmax         NA
  spr.30       NA
  mey          NA
units:  NA </code></pre>
<p>This slot contains the estimates for a series of reference points and for a number of quantities. For example, the value stored at the intersection of <code>msy</code> and <code>harvest</code> corresponds to <span class="math inline">\(F_{MSY}\)</span>, while that of <code>virgin</code> and <code>ssb</code> is the estimate of virgin stock biomass. We can, for example, extract the two standard MSY-related reference points as a named vector using</p>
<pre class="r"><code>pmsy &lt;- refpts(plrp)[&quot;msy&quot;, c(&quot;harvest&quot;, &quot;ssb&quot;), drop=TRUE]</code></pre>
<p>to then use them to visualize the status of the stock in relation to these points, for example</p>
<pre class="r"><code>plot(ssb(stk) / pmsy[&quot;ssb&quot;]) + geom_hline(aes(yintercept=1), linetype=2) +
  ylab(expression(SSB / SSB[MSY]))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/refptplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="more-information-5" class="section level3">
<h3>More information</h3>
<p>For more information on <em>FLBRP</em>, please see the <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a> tutorial.</p>
</div>
</div>
<div id="forecasting-under-different-scenarios" class="section level1">
<h1>Forecasting under different scenarios</h1>
<p>Our final step in this quick tour takes us to the tools in <em>FLR</em> for forecasting the future responses of the stock to alternative management decisions. This example concerns a Short Term Forecast, in which the effect of the current management, for example a maximum catch limit or TAC, on the present year is forecasted, and then a series of alternative increases or decreases in catch are applied to the object representing our current understanding of the stock status and dynamics.</p>
<p>The <a href="http://flr-project.org/FLash">FLash package</a> contains the current implementation of the forecasting mechanism in <em>FLR</em>. Please note that FLash is currently only working on 32 bit R if using Windows. A new forecasting package, called <em>FLasher</em> is about to be released and will only work on 64 bit R.</p>
<pre class="r"><code>library(FLash)</code></pre>
<p>The key element in the <em>FLash</em> interface is the <em>fwdControl</em> class, which allows us to specify the targets and limits that we want the stock to achieve or remain within. But first we need to make some assumptions about the future values of certain quantities, both on the biology (natural mortality, maturity) and the fishery (selectivity, proportion of discards). A common approach for this kind of forecast is to use averages over the last few years (tipycally three) for certain quantities. This can be done in <em>FLR</em> using the <code>stf</code> method in the <em>FLash</em> package.</p>
<pre class="r"><code>library(FLash)
proj &lt;- stf(stk)</code></pre>
<p>Our new object extends up to 2020, and the values for certain stocks have been extended using the mean of the last three years, for example for the weight-at-age in the stock</p>
<pre class="r"><code>stock.wt(proj)[, ac(2011:2020)]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

    year
age  2011     2012     2013     2014     2015     2016     2017    
  1  0.039000 0.052000 0.043000 0.048000 0.024000 0.030000 0.032000
  2  0.100000 0.093000 0.107000 0.104000 0.065000 0.066000 0.069000
  3  0.187000 0.142000 0.153000 0.158000 0.120000 0.117000 0.132000
  4  0.209000 0.188000 0.208000 0.202000 0.207000 0.198000 0.181000
  5  0.355000 0.331000 0.320000 0.312000 0.279000 0.260000 0.270000
  6  0.483000 0.393000 0.354000 0.380000 0.323000 0.329000 0.333000
  7  0.438000 0.484000 0.434000 0.439000 0.379000 0.380000 0.359000
  8  0.422000 0.479000 0.493000 0.484000 0.435000 0.434000 0.458000
  9  0.530000 0.480000 0.662000 0.458000 0.465000 0.479000 0.476000
  10 0.580000 0.518000 0.468000 0.615000 0.457000 0.514000 0.557000
    year
age  2018     2019     2020    
  1  0.028667 0.028667 0.028667
  2  0.066667 0.066667 0.066667
  3  0.123000 0.123000 0.123000
  4  0.195333 0.195333 0.195333
  5  0.269667 0.269667 0.269667
  6  0.328333 0.328333 0.328333
  7  0.372667 0.372667 0.372667
  8  0.442333 0.442333 0.442333
  9  0.473333 0.473333 0.473333
  10 0.509333 0.509333 0.509333

units:  kg </code></pre>
<p>We can now construct a <code>fwdControl</code> object that projects the stock as if catches in the current year, 2018 in this case, were those of the agreed TAC, 85,000 t, and F was then kept in 2019 and 2020 at the same levels as in 2017. The main component of a <em>fwdControl</em> object is a <em>data.frame</em> that must at least contains columns for</p>
<ul>
<li><em>year</em></li>
<li><em>quantity</em>, the quantity to be projected, for example <code>ssb</code>, <code>f</code> or <code>catch</code></li>
<li><em>val</em>, the actual value to be obtained</li>
</ul>
<pre class="r"><code>TAC &lt;- 85000
Flevel &lt;- fbar(stk)[,&quot;2017&quot;]
ctrl &lt;- fwdControl(data.frame(year=2018:2020, quantity=c(&quot;catch&quot;, &quot;f&quot;, &quot;f&quot;), val=c(TAC, Flevel, Flevel)))</code></pre>
<p>Now the <code>fwd</code> method will carry ou the projection using those three object: stock, stock-recruitment and control</p>
<pre class="r"><code>proj &lt;- fwd(proj, control=ctrl, sr=plsr) </code></pre>
<p>and the results can be visualized</p>
<pre class="r"><code>plot(proj) + geom_vline(aes(xintercept=2017.5), linetype=2)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/fwdplot-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="more-information-6" class="section level3">
<h3>More information</h3>
<p>Please see the <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a> and <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a> tutorials for more examples on how to use the capabilitis of <em>FLash</em> to forecast population dynamics under various scenarios.</p>
</div>
</div>
<div id="more-on-flr" class="section level1">
<h1>More on FLR</h1>
<p>Please visit <a href="http://flr-project.org">our website</a> for more information on the FLR packages, tutorials and examples of use, and instructions for getting in touch if you want to report a bug, ask a question or get involved in the development of the <strong>FLR</strong> toolset. The project is run by a team of fisheries scientists that decided to share the R code they were writing and using so a common platform for Quantitative Fisheries Science in R could break the Babel tower spell that J. Schnute first identified</p>
<p>“The cosmic plan for confounding software languages seems to be working remarkably well among the community of quantitative fishery scientists!”</p>
<p>Schnute et al. 2007</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>L. T. Kell, I. Mosqueira, P. Grosjean, J-M. Fromentin, D. Garcia, R. Hillary, E. Jardim, S. Mardle, M. A. Pastoors, J. J. Poos, F. Scott, R. D. Scott; FLR: an open-source framework for the evaluation and development of management strategies. <em>ICES J Mar Sci</em> 2007; 64 (4): 640-646. doi: <a href="https://doi.org/10.1093/icesjms/fsm012">10.1093/icesjms/fsm012</a>.</p>
</div>
<div id="more-information-7" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Alternatively, send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a>.</li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage: <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.6.1 (2019-07-05)</li>
<li>FLCore: 2.6.13.9006</li>
<li>ggplotFL: 2.6.6</li>
<li>FLa4a: 1.6.7</li>
<li>FLBRP: 2.5.3</li>
<li>FLash: 2.5.11</li>
<li><strong>Compiled</strong>: Thu Aug 8 11:36:26 2019</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Iago MOSQUEIRA</strong>. European Commission, DG Joint Research Centre, Directorate D - Sustainable Resources, Unit D.02 Water and Marine Resources, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a>.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
